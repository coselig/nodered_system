[
    {
        "id": "5974e71a9d0de09b",
        "type": "tab",
        "label": "åŒ—æ·B2",
        "disabled": true,
        "info": "",
        "env": []
    },
    {
        "id": "dcd664a676225a7c",
        "type": "group",
        "z": "5974e71a9d0de09b",
        "name": "flow set äº®åº¦è‰²æº«æš«å­˜",
        "style": {
            "label": true
        },
        "nodes": [
            "0767d4fd79c1f972",
            "155cd0a0ab6d0e12",
            "fc84c79760792358",
            "8420f2ccbca60518",
            "6aa8b5208ab33072",
            "8561dd41883f3625"
        ],
        "x": 794,
        "y": 19,
        "w": 712,
        "h": 202
    },
    {
        "id": "51774f658e65f4c3",
        "type": "group",
        "z": "5974e71a9d0de09b",
        "name": "",
        "style": {
            "label": true
        },
        "nodes": [
            "9b7384d856fe59ec",
            "ac21fc849e24691f",
            "d46f9ffd6f0fd704",
            "12191c036f4244e1"
        ],
        "x": 34,
        "y": 399,
        "w": 512,
        "h": 122
    },
    {
        "id": "020a706a08246c9e",
        "type": "group",
        "z": "5974e71a9d0de09b",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "35eb7fed2f49b6e6",
            "5d216f6c53137a1c",
            "b76ec41d1f274b9d"
        ],
        "x": 44,
        "y": 539,
        "w": 582,
        "h": 122
    },
    {
        "id": "768b228161f908e9",
        "type": "group",
        "z": "5974e71a9d0de09b",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "0b60596ffc8e45b1",
            "0b1bf78e17899b26",
            "696920d432f97ea2",
            "e85f197443b2c959",
            "f04c21265207349a",
            "4fe1d2121784dc32",
            "50e404cc9374f030",
            "b99367faceba1eac"
        ],
        "x": 34,
        "y": 679,
        "w": 772,
        "h": 182
    },
    {
        "id": "78e1b477eb58c20a",
        "type": "group",
        "z": "5974e71a9d0de09b",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "f7b0ca65ec57a60e",
            "626601e3686e4fe1",
            "1caa28d405561174",
            "ae1650eaf0c5c3f5",
            "d3c9809e26910e02",
            "b9ec7b2d7ee0a493",
            "57893955429f321d"
        ],
        "x": 34,
        "y": 879,
        "w": 882,
        "h": 142
    },
    {
        "id": "00fa1260ac34663a",
        "type": "group",
        "z": "5974e71a9d0de09b",
        "name": "ä½‡åˆ—åŠŸèƒ½",
        "style": {
            "label": true
        },
        "nodes": [
            "2d52c90e84fea895",
            "d70ff94fc4c499bd",
            "575abf24ecb694d9",
            "c53b989e11b54b86",
            "643e7d55b16d30b7",
            "496ed2d5301b359d",
            "b11a8348248b8fcb",
            "8c179daacc8e080f",
            "6a8ff0f8f065641a",
            "8567316aaebfc995"
        ],
        "x": 1014,
        "y": 499,
        "w": 732,
        "h": 242
    },
    {
        "id": "8929c0eb41e785c6",
        "type": "group",
        "z": "5974e71a9d0de09b",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "6532ea0fd208446a",
            "10dbb614ea742583",
            "463b836d58ca64d4",
            "42985f8ad209a82b",
            "aed60ab618629022",
            "f73e6231f9d2bdeb",
            "63df9f5193ddd8fa"
        ],
        "x": 34,
        "y": 1039,
        "w": 762,
        "h": 122
    },
    {
        "id": "daf2868ad3ecfc15",
        "type": "group",
        "z": "5974e71a9d0de09b",
        "name": "MQTT Discovery",
        "style": {
            "label": true
        },
        "nodes": [
            "9e1b1073a6f57093",
            "5821f8ec5ab6169d",
            "b3bdeb639c49d89a",
            "bdf13bb0e3f993e0",
            "829f5bb19d54ff78",
            "33cf6594cbf61836",
            "140253cdef233964",
            "e3bedc52dc30b2ba"
        ],
        "x": 34,
        "y": 19,
        "w": 732,
        "h": 202
    },
    {
        "id": "575abe9574422685",
        "type": "group",
        "z": "5974e71a9d0de09b",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "70bed951e733b8ce",
            "5e4f5c7b0a148524",
            "0fa92fa39ad1a87b",
            "6b977f9336ea2336",
            "76a4661aae715276"
        ],
        "x": 34,
        "y": 1219,
        "w": 722,
        "h": 122
    },
    {
        "id": "081d293e28056573",
        "type": "junction",
        "z": "5974e71a9d0de09b",
        "x": 940,
        "y": 600,
        "wires": [
            [
                "6a8ff0f8f065641a"
            ]
        ]
    },
    {
        "id": "8567316aaebfc995",
        "type": "junction",
        "z": "5974e71a9d0de09b",
        "g": "00fa1260ac34663a",
        "x": 1440,
        "y": 640,
        "wires": [
            [
                "8c179daacc8e080f"
            ]
        ]
    },
    {
        "id": "9e1b1073a6f57093",
        "type": "inject",
        "z": "5974e71a9d0de09b",
        "g": "daf2868ad3ecfc15",
        "name": "åŠ å…¥ Discovery",
        "props": [
            {
                "p": "action",
                "v": "add",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 160,
        "y": 60,
        "wires": [
            [
                "e3bedc52dc30b2ba"
            ]
        ]
    },
    {
        "id": "5821f8ec5ab6169d",
        "type": "inject",
        "z": "5974e71a9d0de09b",
        "g": "daf2868ad3ecfc15",
        "name": "æ¸…é™¤ Discovery",
        "props": [
            {
                "p": "action",
                "v": "clear",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 160,
        "y": 100,
        "wires": [
            [
                "e3bedc52dc30b2ba"
            ]
        ]
    },
    {
        "id": "b3bdeb639c49d89a",
        "type": "mqtt out",
        "z": "5974e71a9d0de09b",
        "g": "daf2868ad3ecfc15",
        "name": "ç™¼é€åˆ° MQTT Broker",
        "topic": "",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "751ec40a6956d4f9",
        "x": 640,
        "y": 80,
        "wires": []
    },
    {
        "id": "35eb7fed2f49b6e6",
        "type": "mqtt in",
        "z": "5974e71a9d0de09b",
        "g": "020a706a08246c9e",
        "name": "",
        "topic": "homeassistant/light/single/+/+/set",
        "qos": "0",
        "datatype": "auto-detect",
        "broker": "751ec40a6956d4f9",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 200,
        "y": 620,
        "wires": [
            [
                "b76ec41d1f274b9d"
            ]
        ]
    },
    {
        "id": "5d216f6c53137a1c",
        "type": "comment",
        "z": "5974e71a9d0de09b",
        "g": "020a706a08246c9e",
        "name": "å–®è‰²æº«dimmer : homeassistant/light/single/+/+/set",
        "info": "",
        "x": 250,
        "y": 580,
        "wires": []
    },
    {
        "id": "f29ed6b09aaffddd",
        "type": "mqtt out",
        "z": "5974e71a9d0de09b",
        "name": "",
        "topic": "",
        "qos": "0",
        "retain": "false",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "751ec40a6956d4f9",
        "x": 2030,
        "y": 600,
        "wires": []
    },
    {
        "id": "9b7384d856fe59ec",
        "type": "inject",
        "z": "5974e71a9d0de09b",
        "g": "51774f658e65f4c3",
        "name": "",
        "props": [],
        "repeat": "3",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 130,
        "y": 480,
        "wires": [
            []
        ]
    },
    {
        "id": "ac21fc849e24691f",
        "type": "function",
        "z": "5974e71a9d0de09b",
        "g": "51774f658e65f4c3",
        "name": "è¨­å‚™æ¸…å–®",
        "func": "// è¨­å®šè¨­å‚™æ¸…å–®\nvar devices = context.get('devices') || [11,12]; // é»˜èªè¨­å‚™æ¸…å–®\n// ç‚ºæ¯å€‹è¨­å‚™ç”Ÿæˆä¸€æ¢æ¶ˆæ¯\nvar msgs = devices.map(deviceID => {\n    return {\n        deviceID: deviceID // å°‡è¨­å‚™ ID æ·»åŠ åˆ°æ¶ˆæ¯ä¸­\n    };\n});\n\n// è¿”å›æ‰€æœ‰æ¶ˆæ¯\nreturn [msgs];\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 280,
        "y": 480,
        "wires": [
            [
                "d46f9ffd6f0fd704"
            ]
        ]
    },
    {
        "id": "d46f9ffd6f0fd704",
        "type": "function",
        "z": "5974e71a9d0de09b",
        "g": "51774f658e65f4c3",
        "name": "è©¢å•åœ°å€(P404)",
        "func": "// ç²å–ç•¶å‰è¨­å‚™ ID\nvar deviceID = msg.deviceID;\n\n// è¨­å®šåƒæ•¸\nvar functionCode = 0x03;           // åŠŸèƒ½ç¢¼ï¼šè®€å–ä¿æŒæš«å­˜å™¨(Holding Register)\nvar startAddress = 2090;            // èµ·å§‹åœ°å€\nvar quantity = 4;                  // è®€å–æ•¸é‡\n\n// å°‡èµ·å§‹åœ°å€å’Œæ•¸é‡è½‰æ›ç‚ºå…©å€‹å­—ç¯€\nvar startAddressHigh = (startAddress >> 8) & 0xFF; // é«˜ä½\nvar startAddressLow = startAddress & 0xFF;        // ä½ä½\nvar quantityHigh = (quantity >> 8) & 0xFF;        // é«˜ä½\nvar quantityLow = quantity & 0xFF;               // ä½ä½\n\n// çµ„è£æŒ‡ä»¤\nvar message = [\n    deviceID,            // è¨­å‚™åœ°å€\n    functionCode,        // åŠŸèƒ½ç¢¼\n    startAddressHigh,    // èµ·å§‹åœ°å€é«˜ä½\n    startAddressLow,     // èµ·å§‹åœ°å€ä½ä½\n    quantityHigh,        // æ•¸é‡é«˜ä½\n    quantityLow          // æ•¸é‡ä½ä½\n];\n\n// è¨ˆç®— CRC æ ¡é©—\nvar crc = calculateCRC(message);\nmessage.push(crc[0]); // CRC ä½ä½\nmessage.push(crc[1]); // CRC é«˜ä½\n\n// å°‡æŒ‡ä»¤å­˜å…¥ msg.payload\nmsg.payload = Buffer.from(message);\nreturn msg;\n\n// CRC è¨ˆç®—å‡½å¼\nfunction calculateCRC(data) {\n    var crc = 0xFFFF;\n    for (var i = 0; i < data.length; i++) {\n        crc ^= data[i];\n        for (var j = 0; j < 8; j++) {\n            if ((crc & 0x0001) !== 0) {\n                crc >>= 1;\n                crc ^= 0xA001;\n            } else {\n                crc >>= 1;\n            }\n        }\n    }\n    return [crc & 0xFF, (crc >> 8) & 0xFF]; // è¿”å› CRC ä½ä½å’Œé«˜ä½\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 440,
        "y": 480,
        "wires": [
            [
                "081d293e28056573"
            ]
        ]
    },
    {
        "id": "0767d4fd79c1f972",
        "type": "function",
        "z": "5974e71a9d0de09b",
        "g": "dcd664a676225a7c",
        "name": "æ›´æ–°å¿«å– (single brightness, MQTT)",
        "func": "/**\n * MQTT â†’ flow å¿«å–\n * topic: homeassistant/light/single/{id}/{channel}/set/brightness\n * payload: number (0â€“255)\n */\nconst topic = String(msg.topic || \"\");\nconst parts = topic.split(\"/\");\n\n// é©—è­‰ topic æ ¼å¼\nif (parts.length < 7 || parts[0] !== \"homeassistant\" || parts[1] !== \"light\" || parts[2] !== \"single\" || parts[5] !== \"set\" || parts[6] !== \"brightness\") {\n    return null; // æ ¼å¼ä¸ç¬¦ç›´æ¥å¿½ç•¥\n}\n\nconst id = parts[3];\nconst ch = parts[4];\nconst key = `single_${id}_${ch}_brightness`;\n\n// é©—è­‰ payload\nlet val = Number(msg.payload);\nif (!Number.isFinite(val)) return null;\nval = Math.max(0, Math.min(255, Math.round(val)));\n\n// æ›´æ–°å¿«å–\nflow.set(key, val);\nnode.status({ fill: \"green\", shape: \"dot\", text: `${key}=${val}` });\n\nreturn null; // åªæ›´æ–°å¿«å–ï¼Œä¸å¾€ä¸‹å‚³\n",
        "outputs": 0,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1340,
        "y": 60,
        "wires": []
    },
    {
        "id": "155cd0a0ab6d0e12",
        "type": "mqtt in",
        "z": "5974e71a9d0de09b",
        "g": "dcd664a676225a7c",
        "name": "",
        "topic": "homeassistant/light/single/+/+/set/brightness",
        "qos": "0",
        "datatype": "auto-detect",
        "broker": "751ec40a6956d4f9",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 990,
        "y": 60,
        "wires": [
            [
                "0767d4fd79c1f972"
            ]
        ]
    },
    {
        "id": "12191c036f4244e1",
        "type": "comment",
        "z": "5974e71a9d0de09b",
        "g": "51774f658e65f4c3",
        "name": "è¨­å‚™è¼ªè©¢",
        "info": "",
        "x": 120,
        "y": 440,
        "wires": []
    },
    {
        "id": "2d52c90e84fea895",
        "type": "inject",
        "z": "5974e71a9d0de09b",
        "g": "00fa1260ac34663a",
        "name": "æ‰‹å‹• Reset",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 1120,
        "y": 540,
        "wires": [
            [
                "643e7d55b16d30b7"
            ]
        ]
    },
    {
        "id": "d70ff94fc4c499bd",
        "type": "tcp request",
        "z": "5974e71a9d0de09b",
        "g": "00fa1260ac34663a",
        "name": "",
        "server": "192.168.1.202",
        "port": "502",
        "out": "time",
        "ret": "buffer",
        "splitc": "0",
        "newline": "",
        "trim": false,
        "tls": "",
        "x": 1540,
        "y": 600,
        "wires": [
            [
                "c53b989e11b54b86",
                "496ed2d5301b359d",
                "af348cfec7dadc0e"
            ]
        ]
    },
    {
        "id": "575abf24ecb694d9",
        "type": "function",
        "z": "5974e71a9d0de09b",
        "g": "00fa1260ac34663a",
        "name": "æ”¶åˆ°å›æ‡‰ â†’ è§£é–",
        "func": "let t = flow.get(\"currentTimeout\");\nif (t) { clearTimeout(t); flow.set(\"currentTimeout\", null); }\n\nglobal.set(\"waitingReply\", false);\nflow.set(\"currentCmd\", null);\n\nreturn { payload: null }; // å–šé†’ã€Œç™¼é€æµç¨‹ + timeoutã€é€ä¸‹ä¸€ç­†\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1550,
        "y": 700,
        "wires": [
            [
                "8c179daacc8e080f"
            ]
        ]
    },
    {
        "id": "c53b989e11b54b86",
        "type": "function",
        "z": "5974e71a9d0de09b",
        "g": "00fa1260ac34663a",
        "name": "éæ¿¾é›œè¨Š/æ®˜åŒ…",
        "func": "const buf = msg.payload;\nif (!Buffer.isBuffer(buf) || buf.length < 4) {  // ä¾å”è­°èª¿æ•´é–€æª»\n    return null; // ç•¥éï¼Œè®“ timeout æ©Ÿåˆ¶è™•ç†\n}\nreturn msg; // é€šéæ‰å»è§£é–\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1340,
        "y": 700,
        "wires": [
            [
                "575abf24ecb694d9"
            ]
        ]
    },
    {
        "id": "643e7d55b16d30b7",
        "type": "function",
        "z": "5974e71a9d0de09b",
        "g": "00fa1260ac34663a",
        "name": "é‡ç½®ä½‡åˆ—",
        "func": "// ä¸€éµæ¸…é™¤ + è§£é– + å–šé†’ï¼ˆå–®è¼¸å‡ºï¼‰\n// out[0] â†’ {payload:null} å–šé†’ã€Œç™¼é€æµç¨‹ + timeoutã€\n\n// 1) åœæ‰é€¾æ™‚è¨ˆæ™‚å™¨ï¼ˆé¿å…å¹½éˆå›å‘¼ï¼‰\nconst t = flow.get(\"currentTimeout\");\nif (t) { clearTimeout(t); }\n\n// 2) æ¸…é™¤åœ¨é€”ç‹€æ…‹\nflow.set(\"currentTimeout\", null);\nflow.set(\"currentCmd\", null);\nglobal.set(\"waitingReply\", false);\n\n// 3) æ¸…ç©ºä½‡åˆ—\nglobal.set(\"commandsQueue\", []);\n\n// 4) é¡¯ç¤ºç‹€æ…‹ï¼ˆæ–¹ä¾¿æª¢æŸ¥ï¼‰\nnode.status({\n  fill: \"green\",\n  shape: \"ring\",\n  text: \"å·²æ¸…é™¤, queue=0\"\n});\n\n// 5) å›å‚³ï¼šç›´æ¥å–šé†’ç™¼é€æµç¨‹\nreturn { payload: null };\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1260,
        "y": 540,
        "wires": [
            [
                "8c179daacc8e080f"
            ]
        ]
    },
    {
        "id": "496ed2d5301b359d",
        "type": "debug",
        "z": "5974e71a9d0de09b",
        "g": "00fa1260ac34663a",
        "name": "å›è¦†",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1650,
        "y": 560,
        "wires": []
    },
    {
        "id": "b11a8348248b8fcb",
        "type": "debug",
        "z": "5974e71a9d0de09b",
        "g": "00fa1260ac34663a",
        "name": "ç™¼é€",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1490,
        "y": 560,
        "wires": []
    },
    {
        "id": "8c179daacc8e080f",
        "type": "function",
        "z": "5974e71a9d0de09b",
        "g": "00fa1260ac34663a",
        "name": "ç™¼é€æµç¨‹ + timeout",
        "func": "// === ç™¼é€æµç¨‹ + timeout ===\n// åŠŸèƒ½ï¼š\n// 1. å¾ commandsQueue å–å‡ºä¸‹ä¸€ç­†æŒ‡ä»¤ä¸¦ç™¼é€\n// 2. å•Ÿå‹• Timeout + Retry æ©Ÿåˆ¶\n// 3. è¶…é MAX_RETRY â†’ ä¸Ÿæ‰è©²ç­†ï¼Œç¹¼çºŒä¸‹ä¸€ç­†\n// 4. éƒ¨ç½²å¾Œè‡ªå‹•è§£é–ï¼ˆé¿å… waitingReply å¡æ­»ï¼‰\n\nconst TIMEOUT_MS = 600; // å»ºè­° 600~1200msï¼Œä¾è¨­å‚™å›è¦†æ™‚é–“èª¿æ•´\nconst MAX_RETRY = 2;   // æœ€å¤§é‡é€æ¬¡æ•¸ï¼›ç¸½ç™¼é€æ¬¡æ•¸ = 1 + MAX_RETRY\n\n// === Queue ç‹€æ…‹ ===\nlet queue = global.get(\"commandsQueue\");\nif (!Array.isArray(queue)) {\n  queue = [];\n  global.set(\"commandsQueue\", queue);\n}\n\nconst busy = !!global.get(\"waitingReply\");\n\n// === è‹¥å¿™ç¢Œæˆ–ä½‡åˆ—ç©º â†’ ä¸å‹•ä½œ ===\nif (busy || queue.length === 0) return [null, null];\n\n// === å– FIFO å‡ºåˆ— ===\nconst cmd = queue.shift();\nglobal.set(\"commandsQueue\", queue);\nglobal.set(\"waitingReply\", true);\n\n// æº–å‚™è¨Šæ¯ï¼ˆå« retry è¨ˆæ•¸ï¼‰\nlet outMsg = { payload: cmd, retry: 0 };\nflow.set(\"currentCmd\", outMsg);\n\n// === Timeout + Retry æ©Ÿåˆ¶ ===\nfunction armTimeout(cur) {\n  const timer = setTimeout(() => {\n    cur.retry += 1;\n\n    if (cur.retry <= MAX_RETRY) {\n      // Retry â†’ é‡é€åŒä¸€ç­†\n      flow.set(\"currentCmd\", cur);\n      node.send([cur, null]);  // å†é€ä¸€æ¬¡åˆ° TCP\n      armTimeout(cur);         // é‡æ–°æ› Timeout\n    } else {\n      // è¶…é MAX_RETRY â†’ ä¸Ÿæ£„é€™ç­†ï¼Œè§£é–ç¹¼çºŒä¸‹ä¸€ç­†\n      global.set(\"waitingReply\", false);\n      flow.set(\"currentCmd\", null);\n      flow.set(\"currentTimeout\", null);\n\n      node.status({\n        fill: \"red\",\n        shape: \"ring\",\n        text: \"æŒ‡ä»¤è¶…æ™‚å·²ä¸Ÿæ£„\"\n      });\n\n      // è§¸ç™¼ä¸‹ä¸€ç­†\n      node.send([null, { payload: { trigger: true, reason: \"timeout\" } }]);\n    }\n  }, TIMEOUT_MS);\n\n  flow.set(\"currentTimeout\", timer);\n}\n\n// === é€å‡ºç¬¬ä¸€ç­†ä¸¦æ› Timeout ===\narmTimeout(outMsg);\nreturn [outMsg, null];",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "// éƒ¨ç½²ç¯€é»å¾Œï¼Œæ­¤è™•æ·»åŠ çš„ä»£ç¢¼å°‡é‹è¡Œä¸€æ¬¡ã€‚ \n// éƒ¨ç½²åˆå§‹åŒ–ï¼šè‡ªå‹•æ¸…ç©º queue & è§£é–ï¼Œé¿å…éƒ¨ç½²å¾Œå¡æ­»\nglobal.set(\"commandsQueue\", []);\nglobal.set(\"waitingReply\", false);\nflow.set(\"currentCmd\", null);\nflow.set(\"currentTimeout\", null);\n\nnode.status({ fill: \"grey\", shape: \"ring\", text: \"éƒ¨ç½²å¾Œå·²é‡ç½®\" });",
        "finalize": "// ç¯€é»æ­£åœ¨åœæ­¢æˆ–é‡æ–°éƒ¨ç½²æ™‚ï¼Œå°‡é‹è¡Œæ­¤è™•æ·»åŠ çš„ä»£ç¢¼ã€‚ \n// åœæ­¢æˆ–é‡æ–°éƒ¨ç½²æ™‚æ¸…æ‰è¨ˆæ™‚å™¨\nconst t = flow.get(\"currentTimeout\");\nif (t) {\n    clearTimeout(t);\n}\nflow.set(\"currentTimeout\", null);",
        "libs": [],
        "x": 1310,
        "y": 600,
        "wires": [
            [
                "d70ff94fc4c499bd",
                "b11a8348248b8fcb"
            ],
            [
                "8567316aaebfc995"
            ]
        ],
        "info": "ã€åŠŸèƒ½èªªæ˜ã€‘\næ­¤ç¯€é»è² è²¬ï¼š\n1. å¾ commandsQueue ä½‡åˆ—ä¸­å–å‡ºä¸‹ä¸€ç­†æŒ‡ä»¤\n2. ç™¼é€è‡³ TCP ç¯€é»\n3. å•Ÿå‹• Retry æ©Ÿåˆ¶ï¼ˆé è¨­æœ€å¤šé‡é€ 2 æ¬¡ï¼‰\n4. è‹¥æˆåŠŸå›æ‡‰ â†’ ç”± handle_reply è§£é–ä½‡åˆ—\n5. è‹¥å¤±æ•—è¶…æ™‚ â†’ è‡ªå‹•è§£é–ä¸¦è§¸ç™¼ä¸‹ä¸€ç­†é€å‡º\n"
    },
    {
        "id": "6a8ff0f8f065641a",
        "type": "function",
        "z": "5974e71a9d0de09b",
        "g": "00fa1260ac34663a",
        "name": "åŠ å…¥ä½‡åˆ—",
        "func": "// === åŠ å…¥ä½‡åˆ— ===\n// åŠŸèƒ½ï¼š\n// 1. æ¥æ”¶æŒ‡ä»¤ (msg.payload)\n// 2. æ¨å…¥ commandsQueue\n// 3. è‹¥ queue æ»¿ â†’ è‡ªå‹•æ¸…ç©º (Reset)\n// 4. è‹¥æœªå¿™ç¢Œ â†’ å–šé†’ç™¼é€æµç¨‹\n\nlet queue = global.get(\"commandsQueue\") || [];\nlet cmd = msg.payload;\n\n// ğŸ”¹ å¦‚æœæ˜¯ Arrayï¼Œè‡ªå‹•è½‰ Buffer\nif (Array.isArray(cmd)) {\n    cmd = Buffer.from(cmd);\n}\n\nconst MAX_QUEUE = 50;\n\n// === Queue æ»¿ â†’ è‡ªå‹• Reset ===\nif (queue.length >= MAX_QUEUE) {\n    // æ¸…ç©ºæ‰€æœ‰ç‹€æ…‹\n    global.set(\"commandsQueue\", []);\n    global.set(\"waitingReply\", false);\n    flow.set(\"currentCmd\", null);\n    flow.set(\"currentTimeout\", null);\n\n    node.status({\n        fill: \"red\",\n        shape: \"ring\",\n        text: \"âš ï¸ ä½‡åˆ—æ»¿ï¼Œè‡ªå‹•æ¸…ç©º\"\n    });\n\n    return { payload: null };  // å–šé†’ã€Œç™¼é€æµç¨‹ã€ï¼Œä½† queue å·²æ¸…ç©º\n}\n\n// === æ­£å¸¸æƒ…æ³ â†’ push é€²ä½‡åˆ— ===\nqueue.push(cmd);\nglobal.set(\"commandsQueue\", queue);\n\n// === ç‹€æ…‹é¡¯ç¤º ===\nnode.status({\n    fill: \"green\",\n    shape: \"dot\",\n    text: `ä½‡åˆ—é•·åº¦: ${queue.length}`\n});\n\n// === è‹¥ç›®å‰æ²’æœ‰åœ¨ç­‰å›è¦† â†’ è§¸ç™¼ç™¼é€æµç¨‹ ===\nlet waitingReply = global.get(\"waitingReply\") || false;\nif (!waitingReply) {\n    return { payload: null };   // âœ… å–šé†’ã€Œç™¼é€æµç¨‹ã€\n}\nreturn null;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1100,
        "y": 600,
        "wires": [
            [
                "8c179daacc8e080f"
            ]
        ]
    },
    {
        "id": "af348cfec7dadc0e",
        "type": "function",
        "z": "5974e71a9d0de09b",
        "name": "è§£æå›æ‡‰(P404)",
        "func": "// === Channel å°æ‡‰ byte æ˜ å°„ï¼ˆæ ¹æ“šé€šé“æ±ºå®šäº®åº¦èˆ‡è‰²æº«ä½å…ƒï¼‰===\nconst channelByteMap = {\n    // é›™è‰²æº«é€šé“ï¼ˆå«äº®åº¦èˆ‡è‰²æº«ï¼‰\n    \"a\": { type: \"dual\", brightnessByte: 4, colortempByte: 6 },\n    \"b\": { type: \"dual\", brightnessByte: 8, colortempByte: 10 },\n    // å–®è‰²æº«é€šé“ï¼ˆåªæœ‰äº®åº¦ï¼‰\n    \"1\": { type: \"single\", brightnessByte: 4 },\n    \"2\": { type: \"single\", brightnessByte: 6 },\n    \"3\": { type: \"single\", brightnessByte: 8 },\n    \"4\": { type: \"single\", brightnessByte: 10 },\n};\n\n// === ç‡ˆå…·é…ç½®æ¸…å–® ===\n// æ¯ç­†ç‡ˆå…·åŒ…å«åç¨±ã€Modbus IDã€é€šé“ç·¨è™Ÿï¼ˆchannelï¼‰\nconst lights = [\n    { name: \"B2-1\", id: 11, channel: \"1\" },\n    { name: \"B2-2\", id: 11, channel: \"2\" },\n    { name: \"B2-3\", id: 11, channel: \"3\" },\n    { name: \"B2-4\", id: 11, channel: \"4\" },\n    { name: \"B2-5\", id: 12, channel: \"1\" },\n    { name: \"B2-6\", id: 12, channel: \"3\" },\n\n];\n\n// === è‰²æº«è½‰æ›ï¼šModbus æ•¸å€¼ â†’ miredï¼ˆHA ä½¿ç”¨ï¼‰===\nfunction getColortempHA(modbusValue) {\n    const MIRED_MIN = 154;// 6500K\n    const MIRED_MAX = 370;// 2700K\n    return Math.round(MIRED_MAX + modbusValue / 100 * (MIRED_MIN - MIRED_MAX));\n}\n\n// === Modbus CRC é©—è­‰å‡½å¼ ===\nfunction verifyCRC(buf) {\n    let crc = 0xFFFF;\n    for (let i = 0; i < buf.length - 2; i++) {\n        crc ^= buf[i];\n        for (let j = 0; j < 8; j++) {\n            crc = (crc & 1) ? ((crc >> 1) ^ 0xA001) : (crc >> 1);\n        }\n    }\n    const crcLow = crc & 0xFF;\n    const crcHigh = (crc >> 8) & 0xFF;\n    return (crcLow === buf[buf.length - 2]) && (crcHigh === buf[buf.length - 1]);\n}\n\n// === ä¸»ç¨‹å¼é–‹å§‹ ===\nconst buffer = msg.payload;\n\n// === åŸºç¤é˜²éŒ¯æª¢æŸ¥ ===\nif (!Buffer.isBuffer(buffer)) return null;       // è³‡æ–™å¿…é ˆæ˜¯ Buffer\nif (buffer.length !== 13) return null;           // é•·åº¦éœ€ç‚º 13 bytesï¼ˆå›ºå®šæ ¼å¼ï¼‰\n\nconst id = buffer[0];                            // è£ç½® ID\nconst funcCode = buffer[1];                      // åŠŸèƒ½ç¢¼ï¼Œæ‡‰ç‚º 0x03\nconst byteCount = buffer[2];                     // è³‡æ–™é•·åº¦ï¼Œæ‡‰ç‚º 13\n\nif (funcCode !== 0x03 || byteCount !== 8) return null;\nif (!verifyCRC(buffer)) return null;             // CRC é©—è­‰å¤±æ•—å‰‡ä¸Ÿæ£„\n\n// === é–‹å§‹è§£ææ¯ç­†ç‡ˆå…· ===\nconst mqttMsgs = [];\n\nfor (const light of lights) {\n    if (light.id !== id) continue;  // åƒ…è™•ç†æ­¤å°åŒ…å°æ‡‰çš„ ID\n\n    const info = channelByteMap[light.channel];\n    if (!info) continue;  // channel ç„¡å°æ‡‰å®šç¾©å‰‡è·³é\n\n    const deviceID = light.id;\n    const channel = light.channel;\n    const type = info.type;\n    const brightness = buffer[info.brightnessByte];\n\n    // çµ„åˆ MQTT topic è·¯å¾‘\n    const stateTopic = `homeassistant/light/${type}/${deviceID}/${channel}`;\n    const setTopic = `${stateTopic}/set`;\n\n    // === é›™è‰²æº«ç‡ˆå…·è™•ç†é‚è¼¯ ===\n    if (type === \"dual\") {\n        // âœ… æ ¹æ“šäº®åº¦æ±ºå®š ON/OFF ç‹€æ…‹ï¼Œä¸¦æ±ºå®šæ˜¯å¦é€äº®åº¦æŒ‡ä»¤\n        if (brightness === 0) {\n            mqttMsgs.push({ topic: `${stateTopic}/state`, payload: \"OFF\" });\n        } else {\n            mqttMsgs.push(\n                { topic: `${stateTopic}/state`, payload: \"ON\" },\n                { topic: `${stateTopic}/brightness`, payload: brightness.toString() },\n                { topic: `${setTopic}/brightness`, payload: brightness.toString() }\n            );\n        }\n\n        // âœ… ç„¡è«–äº®åº¦ç‚ºä½•éƒ½é€ colortemp\n        const colortempModbus = buffer[info.colortempByte];\n        const colortempMired = getColortempHA(colortempModbus);\n\n        mqttMsgs.push(\n            { topic: `${stateTopic}/colortemp`, payload: colortempMired.toString() },\n            { topic: `${setTopic}/colortemp`, payload: colortempMired.toString() }\n        );\n    }\n\n    // === å–®è‰²æº«ç‡ˆå…·è™•ç†é‚è¼¯ ===\n    if (type === \"single\") {\n        if (brightness === 0) {\n            mqttMsgs.push({ topic: `${stateTopic}/state`, payload: \"OFF\" });\n        } else {\n            mqttMsgs.push(\n                { topic: `${stateTopic}/state`, payload: \"ON\" },\n                { topic: `${stateTopic}/brightness`, payload: brightness.toString() },\n                { topic: `${setTopic}/brightness`, payload: brightness.toString() }\n            );\n        }\n    }\n}\n\n// === è¼¸å‡ºæ‰€æœ‰çµ„åˆçš„ MQTT è¨Šæ¯é™£åˆ— ===\nreturn [mqttMsgs];\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1880,
        "y": 600,
        "wires": [
            [
                "f29ed6b09aaffddd",
                "a4be8af89c0ee7b6"
            ]
        ]
    },
    {
        "id": "fc84c79760792358",
        "type": "mqtt in",
        "z": "5974e71a9d0de09b",
        "g": "dcd664a676225a7c",
        "name": "",
        "topic": "homeassistant/light/dual/+/+/set/brightness",
        "qos": "0",
        "datatype": "auto-detect",
        "broker": "751ec40a6956d4f9",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 990,
        "y": 120,
        "wires": [
            [
                "6aa8b5208ab33072"
            ]
        ]
    },
    {
        "id": "8420f2ccbca60518",
        "type": "mqtt in",
        "z": "5974e71a9d0de09b",
        "g": "dcd664a676225a7c",
        "name": "",
        "topic": "homeassistant/light/dual/+/+/set/colortemp",
        "qos": "0",
        "datatype": "auto-detect",
        "broker": "751ec40a6956d4f9",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 990,
        "y": 180,
        "wires": [
            [
                "8561dd41883f3625"
            ]
        ]
    },
    {
        "id": "6aa8b5208ab33072",
        "type": "function",
        "z": "5974e71a9d0de09b",
        "g": "dcd664a676225a7c",
        "name": "æ›´æ–°å¿«å– dual_brightness",
        "func": "/**\n * topic: homeassistant/light/dual/{id}/{channel}/set/brightness\n * payload: 0~255\n */\nconst parts = String(msg.topic||\"\").split(\"/\");\nif (parts.length<7 || parts[0]!=='homeassistant' || parts[1]!=='light' || parts[2]!=='dual' || parts[5]!=='set' || parts[6]!=='brightness') return null;\nconst id = parts[3];\nconst ch = (parts[4]||'').toLowerCase();\nlet val = Number(msg.payload);\nif (!Number.isFinite(val)) return null;\nval = Math.max(0, Math.min(255, Math.round(val)));\nconst key = `dual_${id}_${ch}_brightness`;\nflow.set(key, val);\nnode.status({fill:'green',shape:'dot',text:`${key}=${val}`});\nreturn null;",
        "outputs": 0,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1310,
        "y": 120,
        "wires": []
    },
    {
        "id": "8561dd41883f3625",
        "type": "function",
        "z": "5974e71a9d0de09b",
        "g": "dcd664a676225a7c",
        "name": "æ›´æ–°å¿«å– dual_colortemp (mired)",
        "func": "/**\n * topic: homeassistant/light/dual/{id}/{channel}/set/colortemp\n * payload: mired å»ºè­° 154~370\n */\nconst parts = String(msg.topic||\"\").split(\"/\");\nif (parts.length<7 || parts[0]!=='homeassistant' || parts[1]!=='light' || parts[2]!=='dual' || parts[5]!=='set' || parts[6]!=='colortemp') return null;\nconst id = parts[3];\nconst ch = (parts[4]||'').toLowerCase();\nlet mired = Number(msg.payload);\nif (!Number.isFinite(mired)) return null;\n// å¤¾åœ¨å¸¸è¦‹ç¯„åœå…§ï¼Œé¿å…ç•°å¸¸å€¼\nmired = Math.max(154, Math.min(370, Math.round(mired)));\nconst key = `dual_${id}_${ch}_colortemp`;\nflow.set(key, mired);\nnode.status({fill:'blue',shape:'dot',text:`${key}=${mired}mired`});\nreturn null;",
        "outputs": 0,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1340,
        "y": 180,
        "wires": []
    },
    {
        "id": "bdf13bb0e3f993e0",
        "type": "inject",
        "z": "5974e71a9d0de09b",
        "g": "daf2868ad3ecfc15",
        "name": "åŠ å…¥ Discovery",
        "props": [
            {
                "p": "action",
                "v": "add",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 160,
        "y": 140,
        "wires": [
            [
                "33cf6594cbf61836"
            ]
        ]
    },
    {
        "id": "829f5bb19d54ff78",
        "type": "inject",
        "z": "5974e71a9d0de09b",
        "g": "daf2868ad3ecfc15",
        "name": "æ¸…é™¤ Discovery",
        "props": [
            {
                "p": "action",
                "v": "clear",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 160,
        "y": 180,
        "wires": [
            [
                "33cf6594cbf61836"
            ]
        ]
    },
    {
        "id": "33cf6594cbf61836",
        "type": "function",
        "z": "5974e71a9d0de09b",
        "g": "daf2868ad3ecfc15",
        "name": "Discovery climate MQTT",
        "func": "// === å‘½åè¦å‰‡ ===\n// path â†’ \"i2/2/1\" (è·¯å¾‘æ¨£å¼ï¼Œç”¨ä¾†çµ„åˆ topic)\n// name â†’ é¡¯ç¤ºåç¨±ï¼Œä¾‹å¦‚ \"å†·æ°£1\"\n// discovery topic:homeassistant/hvac/i2/<id>/<port>/<type>/set\n\n\nlet devices = [\n    { path: \"i2/1/1\", name: \"å†·æ°£\" }\n];\n\nlet msgs = devices.map(dev => {\n    let uid = dev.path.replace(/\\//g, \"_\");  // unique_id\n    let topic = `homeassistant/climate/${uid}/config`;\n    let payload;\n\n    if (msg.action === \"clear\") {\n        payload = \"\";\n    } else if (msg.action === \"add\") {\n        payload = {\n            name: dev.name,\n            unique_id: uid,\n            modes: [\"cool\", \"off\"],\n            mode_command_topic: `homeassistant/hvac/${dev.path}/mode/set`,\n            mode_state_topic: `homeassistant/hvac/${dev.path}/mode/state`,\n            temperature_command_topic: `homeassistant/hvac/${dev.path}/temperature/set`,\n            temperature_state_topic: `homeassistant/hvac/${dev.path}/temperature/state`,\n            min_temp: 16,\n            max_temp: 30,\n            precision: 1,\n            retain: false,\n            optimistic: true,\n            qos: 0\n        };\n        payload = JSON.stringify(payload);\n    }\n\n    return { topic, payload, retain: true };\n});\n\nreturn [msgs];\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 390,
        "y": 160,
        "wires": [
            [
                "140253cdef233964"
            ]
        ]
    },
    {
        "id": "140253cdef233964",
        "type": "mqtt out",
        "z": "5974e71a9d0de09b",
        "g": "daf2868ad3ecfc15",
        "name": "ç™¼é€åˆ° MQTT Broker",
        "topic": "",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "751ec40a6956d4f9",
        "x": 640,
        "y": 160,
        "wires": []
    },
    {
        "id": "0b60596ffc8e45b1",
        "type": "mqtt in",
        "z": "5974e71a9d0de09b",
        "g": "768b228161f908e9",
        "name": "",
        "topic": "homeassistant/hvac/i2/+/+/mode/set",
        "qos": "0",
        "datatype": "auto-detect",
        "broker": "751ec40a6956d4f9",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 210,
        "y": 760,
        "wires": [
            [
                "4fe1d2121784dc32",
                "b99367faceba1eac"
            ]
        ]
    },
    {
        "id": "0b1bf78e17899b26",
        "type": "mqtt in",
        "z": "5974e71a9d0de09b",
        "g": "768b228161f908e9",
        "name": "",
        "topic": "homeassistant/hvac/i2/+/+/temperature/set",
        "qos": "0",
        "datatype": "auto-detect",
        "broker": "751ec40a6956d4f9",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 230,
        "y": 800,
        "wires": [
            [
                "4fe1d2121784dc32",
                "b99367faceba1eac"
            ]
        ]
    },
    {
        "id": "696920d432f97ea2",
        "type": "function",
        "z": "5974e71a9d0de09b",
        "g": "768b228161f908e9",
        "name": "i2 command",
        "func": "const { id, port, device, key } = msg.payload;\n\n// èµ·å§‹æš«å­˜å™¨åœ°å€ï¼ˆä½ è¦å¯«å…¥çš„ä½ç½®ï¼‰\nconst startAddress = 0x01A5;     // å°æ‡‰ 42022\nconst registerCount = 2;         // å¯«å…¥å…©å€‹æš«å­˜å™¨\nconst byteCount = registerCount * 2;  // æ¯å€‹æš«å­˜å™¨ 2 bytes\n\n// å»ºç«‹è³‡æ–™å€ï¼ˆ2 å€‹æš«å­˜å™¨ï¼‰\nconst dataBytes = [\n    0x00, port,       // ç¬¬ 1 å€‹æš«å­˜å™¨ï¼šport = 1 â†’ 00 01\n    device, key       // ç¬¬ 2 å€‹æš«å­˜å™¨ï¼šdevice=2, key=3 â†’ 02 03\n];\n\n// çµ„åˆå®Œæ•´ frameï¼ˆä¸å« CRCï¼‰\nlet frame = [\n    id,\n    0x10,  // Function code: Write multiple registers\n    (startAddress >> 8) & 0xFF,\n    startAddress & 0xFF,\n    0x00, registerCount,\n    byteCount,\n    ...dataBytes\n];\n\n// è¨ˆç®— CRC16ï¼ˆMODBUSï¼‰\nfunction crc16Modbus(buf) {\n    let crc = 0xFFFF;\n    for (let b of buf) {\n        crc ^= b;\n        for (let i = 0; i < 8; i++) {\n            crc = (crc >> 1) ^ ((crc & 1) ? 0xA001 : 0);\n        }\n    }\n    return [crc & 0xFF, (crc >> 8) & 0xFF];\n}\n\nconst crc = crc16Modbus(frame);\nframe.push(...crc);\n\n// é™¤éŒ¯è¼¸å‡ºï¼ˆHEX å¯è®€ï¼‰\nmsg.debug = frame.map(b => b.toString(16).padStart(2, '0')).join(' ');\n\n// å¯¦éš›ç™¼é€ buffer\nmsg.payload = Buffer.from(frame);\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 710,
        "y": 780,
        "wires": [
            [
                "081d293e28056573"
            ]
        ]
    },
    {
        "id": "e85f197443b2c959",
        "type": "comment",
        "z": "5974e71a9d0de09b",
        "g": "768b228161f908e9",
        "name": "i2 å†·æ°£",
        "info": "",
        "x": 110,
        "y": 720,
        "wires": []
    },
    {
        "id": "f04c21265207349a",
        "type": "mqtt out",
        "z": "5974e71a9d0de09b",
        "g": "768b228161f908e9",
        "name": "homeassistant/hvac/i2/+/+/mode/state",
        "topic": "",
        "qos": "1",
        "retain": "false",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "751ec40a6956d4f9",
        "x": 615,
        "y": 820,
        "wires": [],
        "l": false
    },
    {
        "id": "4fe1d2121784dc32",
        "type": "function",
        "z": "5974e71a9d0de09b",
        "g": "768b228161f908e9",
        "name": "id, port, device, key",
        "func": "// topic æ ¼å¼ï¼šhomeassistant/hvac/i2/<id>/<port>/<type>/set\nconst [, , , id, port, type] = msg.topic.split('/');\nconst val = msg.payload.toString().toLowerCase();\n\nconst device = 0;\nconst defaultCoolTemp = 25;\n\nlet key;\nlet stateMsgs = [];\n\n// === Mode è¨­å®š ===\nif (type === \"mode\") {\n    if (val === \"cool\") {\n        key = 1;\n        stateMsgs.push(\n            { topic: `homeassistant/hvac/i2/${id}/${port}/mode/state`, payload: \"cool\", retain: true },\n            { topic: `homeassistant/hvac/i2/${id}/${port}/temperature/state`, payload: String(defaultCoolTemp), retain: true }\n        );\n    } else if (val === \"off\") {\n        key = 0;\n        stateMsgs.push(\n            { topic: `homeassistant/hvac/i2/${id}/${port}/mode/state`, payload: \"off\", retain: true }\n        );\n    }\n}\n\n// === Temperature è¨­å®š ===\nif (type === \"temperature\") {\n    const temp = parseInt(val);\n    key = temp;\n    stateMsgs.push(\n        { topic: `homeassistant/hvac/i2/${id}/${port}/temperature/state`, payload: String(temp), retain: true },\n        { topic: `homeassistant/hvac/i2/${id}/${port}/mode/state`, payload: \"cool\", retain: true }\n    );\n}\n\n// === Output #1: Modbus æŒ‡ä»¤ ===\nconst mainMsg = {\n    payload: { id: +id, port: +port, device, key }\n};\n\n// === è¼¸å‡º ===\n// Output[0] = Modbus æŒ‡ä»¤\n// Output[1] = å¤šç­† MQTT ç‹€æ…‹\nreturn [mainMsg, stateMsgs];\n",
        "outputs": 2,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 520,
        "y": 780,
        "wires": [
            [
                "696920d432f97ea2",
                "50e404cc9374f030"
            ],
            [
                "f04c21265207349a"
            ]
        ]
    },
    {
        "id": "50e404cc9374f030",
        "type": "debug",
        "z": "5974e71a9d0de09b",
        "g": "768b228161f908e9",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 655,
        "y": 740,
        "wires": [],
        "l": false
    },
    {
        "id": "f7b0ca65ec57a60e",
        "type": "comment",
        "z": "5974e71a9d0de09b",
        "g": "78e1b477eb58c20a",
        "name": "TV  ON/OFFï¼ˆé»é–‹å…§å®¹ï¼‰",
        "info": "192.168.1.221 TCP:100\n\né›»è¦–ç‰†é›»è¦–é–‹\n\\xAA\\x11\\xFE\\x01\\x01\\x11\n\né›»è¦–ç‰†é›»è¦–é—œ\n\\xAA\\x11\\xFE\\x01\\x00\\x10",
        "x": 170,
        "y": 920,
        "wires": []
    },
    {
        "id": "626601e3686e4fe1",
        "type": "function",
        "z": "5974e71a9d0de09b",
        "g": "78e1b477eb58c20a",
        "name": "command (ON)",
        "func": "if (msg.payload !== \"ON\") return null;\n\n// è‡ªè¨‚è¦ç™¼é€çš„å®Œæ•´æŒ‡ä»¤\nconst command =[\n    0xAA, 0x11, 0xFE, 0x01, 0x01, 0x11  \n]\n\n\n// ç›´æ¥æ‰“åŒ…æˆ Buffer è¼¸å‡º\nmsg.payload = Buffer.from(command);\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 400,
        "y": 940,
        "wires": [
            [
                "ae1650eaf0c5c3f5",
                "b9ec7b2d7ee0a493"
            ]
        ]
    },
    {
        "id": "1caa28d405561174",
        "type": "function",
        "z": "5974e71a9d0de09b",
        "g": "78e1b477eb58c20a",
        "name": "command (OFF)",
        "func": "if (msg.payload !== \"OFF\") return null;\n\n// è‡ªè¨‚è¦ç™¼é€çš„å®Œæ•´æŒ‡ä»¤\nconst command = [\n    0xAA, 0x11, 0xFE, 0x01, 0x00, 0x10\n];\n\n// ç›´æ¥æ‰“åŒ…æˆ Buffer è¼¸å‡º\nmsg.payload = Buffer.from(command);\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 400,
        "y": 980,
        "wires": [
            [
                "ae1650eaf0c5c3f5",
                "b9ec7b2d7ee0a493"
            ]
        ]
    },
    {
        "id": "ae1650eaf0c5c3f5",
        "type": "tcp request",
        "z": "5974e71a9d0de09b",
        "g": "78e1b477eb58c20a",
        "name": "",
        "server": "192.168.1.221",
        "port": "100",
        "out": "sit",
        "ret": "buffer",
        "splitc": " ",
        "newline": "",
        "trim": false,
        "tls": "",
        "x": 700,
        "y": 940,
        "wires": [
            [
                "57893955429f321d"
            ]
        ]
    },
    {
        "id": "d3c9809e26910e02",
        "type": "mqtt in",
        "z": "5974e71a9d0de09b",
        "g": "78e1b477eb58c20a",
        "name": "",
        "topic": "homeassistant/button/tv",
        "qos": "0",
        "datatype": "auto-detect",
        "broker": "751ec40a6956d4f9",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 170,
        "y": 960,
        "wires": [
            [
                "626601e3686e4fe1",
                "1caa28d405561174"
            ]
        ]
    },
    {
        "id": "b9ec7b2d7ee0a493",
        "type": "debug",
        "z": "5974e71a9d0de09b",
        "g": "78e1b477eb58c20a",
        "name": "è¼¸å‡º",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 615,
        "y": 980,
        "wires": [],
        "l": false
    },
    {
        "id": "57893955429f321d",
        "type": "debug",
        "z": "5974e71a9d0de09b",
        "g": "78e1b477eb58c20a",
        "name": "å›æ‡‰",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 855,
        "y": 940,
        "wires": [],
        "l": false
    },
    {
        "id": "6532ea0fd208446a",
        "type": "comment",
        "z": "5974e71a9d0de09b",
        "g": "8929c0eb41e785c6",
        "name": "æ“´å¤§æ©Ÿæ§åˆ¶ï¼ˆé»é–‹å…§å®¹ï¼‰",
        "info": "ğŸ“˜ æ§åˆ¶æŒ‡ä»¤åˆ—è¡¨ï¼ˆå®Œæ•´æ•´ç†ç‰ˆï¼‰\n\nã€åŸºæœ¬æŒ‡ä»¤ã€‘\nHELP / H / ?\nï¼ é¡¯ç¤ºå…¨éƒ¨æ§åˆ¶æŒ‡ä»¤ã€‚\n\nã€é›»æºæ§åˆ¶ã€‘\nPWR S/0/1\nSï¼é¡¯ç¤ºç‹€æ…‹\n0ï¼é—œé–‰\n1ï¼é–‹å•Ÿ\n\nã€è¼¸å…¥ä¾†æºé¸æ“‡ã€‘\nSOURCE S/0~5\nSï¼é¡¯ç¤ºç‹€æ…‹\n0ï¼HDMI 1\n1ï¼HDMI 2\n2ï¼å…‰çº–ï¼ˆOpticalï¼‰\n3ï¼åŒè»¸ï¼ˆCoaxialï¼‰\n4ï¼LINE IN\n5ï¼RCA IN\n\nã€éŸ³é‡æ§åˆ¶ã€‘\nVOL S/0~-80\nSï¼é¡¯ç¤ºéŸ³é‡\n+ ï¼ +0.5 dB\n++ ï¼ +2 dB\n- ï¼ -0.5 dB\n-- ï¼ -2 dB\nä¹Ÿå¯è¼¸å…¥ 0 ~ -80 dB\n\nMUTE S/0/1\nSï¼é¡¯ç¤ºç‹€æ…‹\n0ï¼å–æ¶ˆéœéŸ³\n1ï¼éœéŸ³\n\nã€éº¥å…‹é¢¨æ§åˆ¶ã€‘\nMICVOL S/0~30\nSï¼é¡¯ç¤ºéŸ³é‡\n+ ï¼ +0.5 dB\n- ï¼ -0.5 dB\nä¹Ÿå¯è¼¸å…¥ 0 ~ 30\n\nMICMODE S/0~3\nSï¼é¡¯ç¤ºç‹€æ…‹\n0ï¼é—œé–‰\n1ï¼æ™®é€šæ¨¡å¼\n2ï¼Phantom æ¨¡å¼\n3ï¼Line æ¨¡å¼\n\nã€ç³»çµ±æ“ä½œã€‘\nFADEFAULT ï¼ æ¢å¾©å‡ºå» é è¨­\nREBOOT ï¼ é‡å•Ÿ\n\nã€ç¶²è·¯è³‡è¨Šã€‘\nIPCONFIG ï¼ é¡¯ç¤º IP\nRESETIP ï¼ æ¢å¾©å‡ºå»  IP\nSHOWMAC ï¼ é¡¯ç¤º MAC\nSHOWTPORT ï¼ é¡¯ç¤º Telnet Port\nSHOWHPORT ï¼ é¡¯ç¤º HTTP Port\n\nã€ç¶²è·¯è¨­å®šã€‘\nSIPADD ï¼ è¨­å®š IP\nSNETMASK ï¼ è¨­å®šç¶²è·¯é®ç½©\nSGATEWAY ï¼ è¨­å®šé–˜é“\nSHTTPPORT ï¼ è¨­å®š HTTP Portï¼ˆ1~62235ï¼Œé è¨­ 80ï¼‰\nSTELNETPPORT ï¼ è¨­å®š Telnet Portï¼ˆ1~62235ï¼Œé è¨­ 23ï¼‰\n",
        "x": 170,
        "y": 1080,
        "wires": []
    },
    {
        "id": "10dbb614ea742583",
        "type": "tcp request",
        "z": "5974e71a9d0de09b",
        "g": "8929c0eb41e785c6",
        "name": "",
        "server": "192.168.1.220",
        "port": "23",
        "out": "sit",
        "ret": "buffer",
        "splitc": " ",
        "newline": "",
        "trim": false,
        "tls": "",
        "x": 600,
        "y": 1120,
        "wires": [
            [
                "42985f8ad209a82b"
            ]
        ]
    },
    {
        "id": "463b836d58ca64d4",
        "type": "mqtt in",
        "z": "5974e71a9d0de09b",
        "g": "8929c0eb41e785c6",
        "name": "",
        "topic": "homeassistant/button/amp",
        "qos": "0",
        "datatype": "auto-detect",
        "broker": "751ec40a6956d4f9",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 170,
        "y": 1120,
        "wires": [
            [
                "f73e6231f9d2bdeb"
            ]
        ]
    },
    {
        "id": "42985f8ad209a82b",
        "type": "debug",
        "z": "5974e71a9d0de09b",
        "g": "8929c0eb41e785c6",
        "name": "å›æ‡‰",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 735,
        "y": 1120,
        "wires": [],
        "l": false
    },
    {
        "id": "aed60ab618629022",
        "type": "inject",
        "z": "5974e71a9d0de09b",
        "g": "8929c0eb41e785c6",
        "name": "æ‰‹å‹•æ¸¬è©¦",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "VOL +\\r",
        "payloadType": "str",
        "x": 580,
        "y": 1080,
        "wires": [
            [
                "10dbb614ea742583"
            ]
        ]
    },
    {
        "id": "70bed951e733b8ce",
        "type": "mqtt in",
        "z": "5974e71a9d0de09b",
        "g": "575abe9574422685",
        "name": "",
        "topic": "cdps/command",
        "qos": "0",
        "datatype": "auto-detect",
        "broker": "751ec40a6956d4f9",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 140,
        "y": 1300,
        "wires": [
            [
                "76a4661aae715276"
            ]
        ]
    },
    {
        "id": "5e4f5c7b0a148524",
        "type": "comment",
        "z": "5974e71a9d0de09b",
        "g": "575abe9574422685",
        "name": "ï¼´ï¼¶ç‰†æ§åˆ¶ï¼ˆé»é–‹å…§å®¹ï¼‰",
        "info": "20251119\nCDPS-CS11\nIPï¼š192.168.1.224\næ§åˆ¶åŸ ï¼šTCP 23\næŒ‡ä»¤çµå°¾\\x0d\\x0a\n\n\nset out A route 1~4\nè¨Šæº1~4åˆ‡æ›\n\nset power ON/OFF\né›»æºé–‹é—œ",
        "x": 170,
        "y": 1260,
        "wires": []
    },
    {
        "id": "0fa92fa39ad1a87b",
        "type": "tcp request",
        "z": "5974e71a9d0de09b",
        "g": "575abe9574422685",
        "name": "",
        "server": "192.168.1.224",
        "port": "23",
        "out": "time",
        "ret": "buffer",
        "splitc": "0",
        "newline": "",
        "trim": false,
        "tls": "",
        "x": 560,
        "y": 1300,
        "wires": [
            [
                "6b977f9336ea2336"
            ]
        ]
    },
    {
        "id": "6b977f9336ea2336",
        "type": "debug",
        "z": "5974e71a9d0de09b",
        "g": "575abe9574422685",
        "name": "å›æ‡‰",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 695,
        "y": 1300,
        "wires": [],
        "l": false
    },
    {
        "id": "b76ec41d1f274b9d",
        "type": "function",
        "z": "5974e71a9d0de09b",
        "g": "020a706a08246c9e",
        "name": "command(single)new",
        "func": "/**\n * å–®è‰²æº«ï¼ˆsingleï¼‰æ§åˆ¶ï¼šç”¢ç”Ÿ Modbus æŒ‡ä»¤ï¼ˆå« CRC16ï¼‰\n * æ”¯æ´ payload = { \"state\": \"ON\" | \"OFF\", \"brightness\": number }\n */\n\nconst DEFAULT_BRIGHTNESS = 100;\nconst BRIGHTNESS_TIME = 0x05;\n\nconst CHANNEL_REGISTER_MAP = {\n    \"1\": 0x082A,\n    \"2\": 0x082B,\n    \"3\": 0x082C,\n    \"4\": 0x082D\n};\n\n/* ------------------------ CRC-16 MODBUS ------------------------ */\nfunction crc16(buf) {\n    let crc = 0xFFFF;\n    for (const b of buf) {\n        crc ^= b;\n        for (let i = 0; i < 8; i++) {\n            crc = (crc & 1)\n                ? ((crc >> 1) ^ 0xA001)\n                : (crc >> 1);\n        }\n    }\n    return crc;\n}\n\n/* ========================== ä¸»æµç¨‹ =========================== */\nconst topic = String(msg.topic || \"\");\nconst parts = topic.split(\"/\");\n\nif (parts.length !== 6) return null;\nif (parts[0] !== \"homeassistant\") return null;\nif (parts[1] !== \"light\") return null;\nif (parts[2] !== \"single\") return null;\nif (parts[5] !== \"set\") return null;\n\nconst slaveId = Number(parts[3]);\nconst channel = parts[4];\n\nif (!Number.isInteger(slaveId) || slaveId <= 0) return null;\nconst reg = CHANNEL_REGISTER_MAP[channel];\nif (!reg) return null;\n\n/* ------------------------ è§£æ payload ------------------------ */\nlet isOn = false;\nlet brightnessFromPayload = null;\n\nif (typeof msg.payload === \"object\" && msg.payload !== null) {\n    // JSON æ ¼å¼ {\"state\":\"ON\",\"brightness\":112}\n    if (typeof msg.payload.state === \"string\") {\n        isOn = (msg.payload.state.toUpperCase() === \"ON\");\n    }\n    if (typeof msg.payload.brightness === \"number\") {\n        brightnessFromPayload = msg.payload.brightness;\n    }\n} else if (typeof msg.payload === \"string\") {\n    isOn = (msg.payload.toUpperCase() === \"ON\");\n} else if (typeof msg.payload === \"boolean\") {\n    isOn = msg.payload;\n}\n\n/* ------------------------ äº®åº¦è™•ç† ------------------------ */\nconst brightnessKey = `single_${slaveId}_${channel}_brightness`;\nlet useBrightness = null;\n\n// payload æœ‰ brightness â†’ ç”¨ payload åŒæ™‚æ›´æ–°å¿«å–\nif (typeof brightnessFromPayload === \"number\") {\n    useBrightness = Math.round(brightnessFromPayload);\n    flow.set(brightnessKey, useBrightness);\n\n    // å¦å‰‡ç”¨å¿«å–\n} else {\n    useBrightness = flow.get(brightnessKey);\n    if (typeof useBrightness !== \"number\") {\n        useBrightness = DEFAULT_BRIGHTNESS;\n    }\n}\n\n// ç¯„åœä¿è­· 0~100\nuseBrightness = Math.min(100, Math.max(0, useBrightness));\n\n// OFF = 0ã€ON = äº®åº¦\nconst value = isOn ? useBrightness : 0x00;\n\n/* ------------------------ çµ„ Modbus æŒ‡ä»¤ ------------------------ */\nconst hi = (reg >> 8) & 0xFF;\nconst lo = reg & 0xFF;\n\nconst cmd = Buffer.from([\n    slaveId,\n    0x06,\n    hi,\n    lo,\n    BRIGHTNESS_TIME,\n    value\n]);\n\n/* ------------------------ åŠ  CRC ------------------------ */\nconst crc = crc16(cmd);\nconst crcLow = crc & 0xFF;\nconst crcHigh = (crc >> 8) & 0xFF;\n\nmsg.payload = Buffer.concat([\n    cmd,\n    Buffer.from([crcLow, crcHigh])\n]);\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 500,
        "y": 620,
        "wires": [
            [
                "081d293e28056573"
            ]
        ]
    },
    {
        "id": "a4be8af89c0ee7b6",
        "type": "debug",
        "z": "5974e71a9d0de09b",
        "name": "debug 1",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1990,
        "y": 760,
        "wires": []
    },
    {
        "id": "e2c6bb46a9ed4dd2",
        "type": "mqtt out",
        "z": "5974e71a9d0de09b",
        "name": "",
        "topic": "homeassistant/light/single/12/1/brightness",
        "qos": "0",
        "retain": "false",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "751ec40a6956d4f9",
        "x": 2150,
        "y": 700,
        "wires": []
    },
    {
        "id": "977e3809e73ec222",
        "type": "inject",
        "z": "5974e71a9d0de09b",
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "50",
        "payloadType": "num",
        "x": 1860,
        "y": 700,
        "wires": [
            [
                "e2c6bb46a9ed4dd2"
            ]
        ]
    },
    {
        "id": "e3bedc52dc30b2ba",
        "type": "function",
        "z": "5974e71a9d0de09b",
        "g": "daf2868ad3ecfc15",
        "name": "Discovery lights MQTT",
        "func": "/**\n * å‘½åè¦å‰‡ï¼š\n * relay_id_channel  â†’ ä¾‹å¦‚ relay_11_1\n * single_id_channel â†’ ä¾‹å¦‚ single_11_2\n * dual_id_channel   â†’ ä¾‹å¦‚ dual_12_aã€dual_12_b\n */\n\nlet devices = [\n    { path: \"single/11/1\", name: \"å¾ŒåµŒç‡ˆ\" },\n    { path: \"single/11/2\", name: \"ä¸­åµŒç‡ˆ\" },\n    { path: \"single/11/3\", name: \"å‰åµŒç‡ˆ\" },\n    { path: \"single/11/4\", name: \"Logo\" },\n    { path: \"single/12/1\", name: \"å¾Œç‡ˆæ¢\" },\n    { path: \"single/12/3\", name: \"å‰ç‡ˆæ¢\" },\n];\n\nlet msgs;\n\nif (msg.action === \"clear\") {\n    // å¼·åˆ¶å…¨éƒ¨æ¸…é™¤\n    msgs = devices.map(dev => {\n        let uid = dev.path.replace(/\\//g, \"_\");\n        return {\n            topic: `homeassistant/light/${uid}/config`,\n            payload: \"\",\n            retain: true\n        };\n    });\n} else if (msg.action === \"add\") {\n    // åŸæœ¬ add çš„æµç¨‹\n    msgs = devices.map(dev => {\n        let uid = dev.path.replace(/\\//g, \"_\");\n        let topic = `homeassistant/light/${uid}/config`;\n        let basePayload = {\n            name: dev.name,\n            unique_id: uid,\n            object_id: uid,\n            payload_on: \"ON\",\n            payload_off: \"OFF\",\n            optimistic: true,\n            state_topic: `homeassistant/light/${dev.path}/state`,\n            command_topic: `homeassistant/light/${dev.path}/set`\n        };\n\n        if (dev.path.startsWith(\"single/\")) {\n            basePayload.brightness = true;\n            basePayload.brightness_state_topic = `homeassistant/light/${dev.path}/brightness`;\n            basePayload.brightness_command_topic = `homeassistant/light/${dev.path}/set/brightness`;\n            basePayload.brightness_scale = 100;\n        } else if (dev.path.startsWith(\"dual/\")) {\n            basePayload.brightness = true;\n            basePayload.brightness_state_topic = `homeassistant/light/${dev.path}/brightness`;\n            basePayload.brightness_command_topic = `homeassistant/light/${dev.path}/set/brightness`;\n            basePayload.brightness_scale = 100;\n            basePayload.color_temp_state_topic = `homeassistant/light/${dev.path}/colortemp`;\n            basePayload.color_temp_command_topic = `homeassistant/light/${dev.path}/set/colortemp`;\n            basePayload.min_mireds = 154;  // 6500K\n            basePayload.max_mireds = 370;  // 2700K\n        }\n\n        return {\n            topic,\n            payload: JSON.stringify(basePayload),\n            retain: true\n        };\n    });\n}\n\nreturn [msgs];\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 380,
        "y": 80,
        "wires": [
            [
                "b3bdeb639c49d89a"
            ]
        ]
    },
    {
        "id": "b99367faceba1eac",
        "type": "debug",
        "z": "5974e71a9d0de09b",
        "g": "768b228161f908e9",
        "name": "debug 3",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 460,
        "y": 720,
        "wires": []
    },
    {
        "id": "f73e6231f9d2bdeb",
        "type": "function",
        "z": "5974e71a9d0de09b",
        "g": "8929c0eb41e785c6",
        "name": "command",
        "func": "msg.payload = `${msg.payload}\\r\\n`;\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 380,
        "y": 1120,
        "wires": [
            [
                "10dbb614ea742583",
                "63df9f5193ddd8fa"
            ]
        ]
    },
    {
        "id": "63df9f5193ddd8fa",
        "type": "debug",
        "z": "5974e71a9d0de09b",
        "g": "8929c0eb41e785c6",
        "name": "debug 4",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 380,
        "y": 1080,
        "wires": []
    },
    {
        "id": "76a4661aae715276",
        "type": "function",
        "z": "5974e71a9d0de09b",
        "g": "575abe9574422685",
        "name": "command",
        "func": "msg.payload = `${msg.payload}\\r\\n`;\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 380,
        "y": 1300,
        "wires": [
            [
                "0fa92fa39ad1a87b"
            ]
        ]
    },
    {
        "id": "751ec40a6956d4f9",
        "type": "mqtt-broker",
        "name": "",
        "broker": "192.168.1.3",
        "port": "1883",
        "clientid": "",
        "autoConnect": true,
        "usetls": false,
        "protocolVersion": "4",
        "keepalive": "60",
        "cleansession": true,
        "autoUnsubscribe": true,
        "birthTopic": "",
        "birthQos": "0",
        "birthPayload": "",
        "birthMsg": {},
        "closeTopic": "",
        "closeQos": "0",
        "closePayload": "",
        "closeMsg": {},
        "willTopic": "",
        "willQos": "0",
        "willPayload": "",
        "willMsg": {},
        "userProps": "",
        "sessionExpiry": ""
    }
]