[
    {
        "id": "79859e535099be0e",
        "type": "tab",
        "label": "æ£®é–£v2",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "f6abec360d64a7b8",
        "type": "group",
        "z": "79859e535099be0e",
        "name": "flow set äº®åº¦è‰²æº«æš«å­˜",
        "style": {
            "label": true
        },
        "nodes": [
            "ede4f9311185a799",
            "aaa562fc313338fb",
            "9501c196dc6f5297",
            "404907156d8b1727",
            "6b4e8d812e09c533",
            "c70aa66203fa62c6"
        ],
        "x": 894,
        "y": 39,
        "w": 712,
        "h": 202
    },
    {
        "id": "981c0bbbbf419219",
        "type": "group",
        "z": "79859e535099be0e",
        "name": "è¨­å‚™è¼ªè©¢",
        "style": {
            "label": true
        },
        "nodes": [
            "a874cc7a560dc780",
            "227355e9732d65dd",
            "a2b77a17d37084df"
        ],
        "x": 34,
        "y": 319,
        "w": 532,
        "h": 82
    },
    {
        "id": "7e671b9dfb6035e0",
        "type": "group",
        "z": "79859e535099be0e",
        "name": "å–®è‰²æº«dimmer : homeassistant/light/single/+/+/set",
        "style": {
            "label": true
        },
        "nodes": [
            "e2ec50d37f7071a7",
            "4dfee758a3812ea5"
        ],
        "x": 34,
        "y": 419,
        "w": 532,
        "h": 82
    },
    {
        "id": "cb7ac42eb2b47bae",
        "type": "group",
        "z": "79859e535099be0e",
        "name": "i2å†·æ°£",
        "style": {
            "label": true
        },
        "nodes": [
            "f1e9f24be05b2016",
            "52af17a09885da8f",
            "de248c92ee121b6a",
            "64aa699af43a6eb4",
            "6c88bbdf905ec93e",
            "3b0248d05a49efb6",
            "efd311ccaaf04dde"
        ],
        "x": 34,
        "y": 959,
        "w": 832,
        "h": 162
    },
    {
        "id": "77b1f027c533026f",
        "type": "group",
        "z": "79859e535099be0e",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "d9c41e07f78057e0",
            "504019c6ff91850e",
            "f9176ac9d0761038",
            "e5d907ba68258212",
            "6bfe26334c3a9ef2",
            "acaa26475ad962d6",
            "fbb87579d6d438b3",
            "dacef01f5e9cce9f",
            "06b95753cb12b3eb",
            "c96820edd7b7eb09"
        ],
        "x": 54,
        "y": 1159,
        "w": 1152,
        "h": 142
    },
    {
        "id": "0e61521047ef3674",
        "type": "group",
        "z": "79859e535099be0e",
        "name": "ä½‡åˆ—åŠŸèƒ½",
        "style": {
            "label": true
        },
        "nodes": [
            "51bb7ebb86b32127",
            "7021d679c1fcbd80",
            "07e4647b6b26109e",
            "9203517f86f8b62e",
            "0fbd9354e637f4c5",
            "75ee7aea6cde6566",
            "97bb13b4a9ed0afe",
            "894d1465d5eb9810",
            "94438fc93e4fd89b",
            "573bdd7cc8dc6707",
            "870d64ed9aef6fec",
            "d56a6d6541454cc1",
            "29d764fcfc0791af"
        ],
        "x": 1194,
        "y": 819,
        "w": 1172,
        "h": 342
    },
    {
        "id": "fee287b36585eb62",
        "type": "group",
        "z": "79859e535099be0e",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "92a69b61bf4be41c",
            "1273d1fbafa6d412",
            "e6903d63903c0a07",
            "998e11759241cfbf",
            "9d3806398603dd04",
            "15b05e2bb89e72e6",
            "5a5102c1e8dd881f",
            "071cc0948a816526",
            "a94012a54dfce52e",
            "dcdc489e0899a97d"
        ],
        "x": 54,
        "y": 1319,
        "w": 942,
        "h": 162
    },
    {
        "id": "3a585159d7619ee6",
        "type": "group",
        "z": "79859e535099be0e",
        "name": "MQTT Discovery",
        "style": {
            "label": true
        },
        "nodes": [
            "1c4b471e93bf9d59",
            "f04919700209f21d",
            "1cc00f3c0b2cb7f2",
            "1fb83ff1a5382b63",
            "0cf2ed797f2abc88",
            "d8acce7dd404c11a",
            "5e251390605dc1d7",
            "f6bf1604e7eae94d",
            "49d0d52e18175e9f",
            "78f4728893f104ea",
            "f0a53827097b2671",
            "2ceea1da7a9b4c81",
            "8f9e900c7e09ee50",
            "928b6d4010212bf9"
        ],
        "x": 34,
        "y": 19,
        "w": 832,
        "h": 282
    },
    {
        "id": "ab24a48df3037b0c",
        "type": "group",
        "z": "79859e535099be0e",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "119c643c2ba030ad",
            "757c05927dbf6685",
            "0f430bed7eeddeec",
            "5cdee3ffc6572075",
            "04eb16dbcb17fb36",
            "475bf3086146b723",
            "42aa1110d8a20ee4",
            "a8ac8c92efdfdb18"
        ],
        "x": 54,
        "y": 1519,
        "w": 792,
        "h": 142
    },
    {
        "id": "b662aa09fba3884d",
        "type": "group",
        "z": "79859e535099be0e",
        "name": "æ—¥ç«‹å†·æ°£",
        "style": {
            "label": true
        },
        "nodes": [
            "061a3cf0fdc32f02",
            "9e48970838d91a36",
            "6d20207c06b7aa83",
            "27a7dd6e9d9fdae8",
            "1c5a90ffab54229c",
            "489e84f129e98e9d"
        ],
        "x": 34,
        "y": 799,
        "w": 432,
        "h": 122
    },
    {
        "id": "af19c60e6b32205e",
        "type": "group",
        "z": "79859e535099be0e",
        "name": "å–®è‰²æº«dimmer : homeassistant/light/dual/+/+/set",
        "style": {
            "label": true
        },
        "nodes": [
            "72010986a865dacb",
            "502e5684346e25d1"
        ],
        "x": 34,
        "y": 519,
        "w": 532,
        "h": 82
    },
    {
        "id": "80259d33a2320f8b",
        "type": "group",
        "z": "79859e535099be0e",
        "name": "æ²ç°¾: homeassistant/cover/+/+/+/set",
        "style": {
            "label": true
        },
        "nodes": [
            "9e8d59129c920643",
            "5c535193a21eb19a",
            "49ddb436293a424f",
            "6f5bfe91ac316558"
        ],
        "x": 34,
        "y": 619,
        "w": 592,
        "h": 162
    },
    {
        "id": "c0fa48505f5c7846",
        "type": "group",
        "z": "79859e535099be0e",
        "name": "FeedBack",
        "style": {
            "label": true
        },
        "nodes": [
            "594b03bc7eea879e",
            "31f543d38254a0ac",
            "2442530f4e5ca97f",
            "60674ad3db7eaaf9",
            "6de84d0186481cfd",
            "86fc96d6f1ab87c8",
            "0989d9ef2ad0970a",
            "23bf88cce761058f",
            "413cb1deb2e44ac2",
            "d3d9561ca4f0dbd2"
        ],
        "x": 2394,
        "y": 899,
        "w": 772,
        "h": 202
    },
    {
        "id": "d56a6d6541454cc1",
        "type": "group",
        "z": "79859e535099be0e",
        "g": "0e61521047ef3674",
        "name": "å†·æ°£ç¶²é—œ",
        "style": {
            "label": true,
            "stroke-opacity": "0"
        },
        "nodes": [
            "170d3db142080853"
        ],
        "x": 1874,
        "y": 859,
        "w": 252,
        "h": 82
    },
    {
        "id": "29d764fcfc0791af",
        "type": "group",
        "z": "79859e535099be0e",
        "g": "0e61521047ef3674",
        "name": "å†·æ°£ç¶²é—œ",
        "style": {
            "label": true,
            "stroke-opacity": "0"
        },
        "nodes": [
            "9b837e196b0b38cd"
        ],
        "x": 1874,
        "y": 899,
        "w": 252,
        "h": 82
    },
    {
        "id": "9ef757eadc58071e",
        "type": "junction",
        "z": "79859e535099be0e",
        "x": 1100,
        "y": 880,
        "wires": [
            [
                "894d1465d5eb9810"
            ]
        ]
    },
    {
        "id": "94438fc93e4fd89b",
        "type": "junction",
        "z": "79859e535099be0e",
        "g": "0e61521047ef3674",
        "x": 1620,
        "y": 980,
        "wires": [
            [
                "97bb13b4a9ed0afe"
            ]
        ]
    },
    {
        "id": "fbb87579d6d438b3",
        "type": "junction",
        "z": "79859e535099be0e",
        "d": true,
        "g": "77b1f027c533026f",
        "x": 720,
        "y": 1220,
        "wires": [
            [
                "06b95753cb12b3eb",
                "c96820edd7b7eb09"
            ]
        ]
    },
    {
        "id": "dacef01f5e9cce9f",
        "type": "junction",
        "z": "79859e535099be0e",
        "d": true,
        "g": "77b1f027c533026f",
        "x": 1080,
        "y": 1240,
        "wires": [
            [
                "acaa26475ad962d6"
            ]
        ]
    },
    {
        "id": "5a5102c1e8dd881f",
        "type": "junction",
        "z": "79859e535099be0e",
        "d": true,
        "g": "fee287b36585eb62",
        "x": 540,
        "y": 1380,
        "wires": [
            [
                "a94012a54dfce52e",
                "dcdc489e0899a97d"
            ]
        ]
    },
    {
        "id": "071cc0948a816526",
        "type": "junction",
        "z": "79859e535099be0e",
        "d": true,
        "g": "fee287b36585eb62",
        "x": 880,
        "y": 1400,
        "wires": [
            [
                "e6903d63903c0a07"
            ]
        ]
    },
    {
        "id": "04eb16dbcb17fb36",
        "type": "junction",
        "z": "79859e535099be0e",
        "d": true,
        "g": "ab24a48df3037b0c",
        "x": 440,
        "y": 1600,
        "wires": [
            [
                "42aa1110d8a20ee4",
                "a8ac8c92efdfdb18"
            ]
        ]
    },
    {
        "id": "475bf3086146b723",
        "type": "junction",
        "z": "79859e535099be0e",
        "d": true,
        "g": "ab24a48df3037b0c",
        "x": 720,
        "y": 1600,
        "wires": [
            [
                "0f430bed7eeddeec"
            ]
        ]
    },
    {
        "id": "573bdd7cc8dc6707",
        "type": "junction",
        "z": "79859e535099be0e",
        "g": "0e61521047ef3674",
        "x": 2220,
        "y": 940,
        "wires": [
            [
                "0fbd9354e637f4c5",
                "413cb1deb2e44ac2",
                "07e4647b6b26109e"
            ]
        ]
    },
    {
        "id": "413cb1deb2e44ac2",
        "type": "junction",
        "z": "79859e535099be0e",
        "g": "c0fa48505f5c7846",
        "x": 2440,
        "y": 1000,
        "wires": [
            [
                "31f543d38254a0ac",
                "6de84d0186481cfd",
                "86fc96d6f1ab87c8",
                "0989d9ef2ad0970a"
            ]
        ]
    },
    {
        "id": "23bf88cce761058f",
        "type": "junction",
        "z": "79859e535099be0e",
        "g": "c0fa48505f5c7846",
        "x": 2940,
        "y": 1020,
        "wires": [
            [
                "594b03bc7eea879e",
                "2442530f4e5ca97f"
            ]
        ]
    },
    {
        "id": "1c4b471e93bf9d59",
        "type": "inject",
        "z": "79859e535099be0e",
        "g": "3a585159d7619ee6",
        "name": "åŠ å…¥ Discovery",
        "props": [
            {
                "p": "action",
                "v": "add",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 160,
        "y": 60,
        "wires": [
            [
                "8f9e900c7e09ee50"
            ]
        ]
    },
    {
        "id": "f04919700209f21d",
        "type": "inject",
        "z": "79859e535099be0e",
        "g": "3a585159d7619ee6",
        "name": "æ¸…é™¤ Discovery",
        "props": [
            {
                "p": "action",
                "v": "clear",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 160,
        "y": 100,
        "wires": [
            [
                "8f9e900c7e09ee50"
            ]
        ]
    },
    {
        "id": "1cc00f3c0b2cb7f2",
        "type": "mqtt out",
        "z": "79859e535099be0e",
        "g": "3a585159d7619ee6",
        "name": "ç™¼é€åˆ° MQTT Broker",
        "topic": "",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "751ec40a6956d4f9",
        "x": 740,
        "y": 80,
        "wires": []
    },
    {
        "id": "e2ec50d37f7071a7",
        "type": "mqtt in",
        "z": "79859e535099be0e",
        "g": "7e671b9dfb6035e0",
        "name": "",
        "topic": "homeassistant/light/single/+/+/set",
        "qos": "0",
        "datatype": "auto-detect",
        "broker": "751ec40a6956d4f9",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 190,
        "y": 460,
        "wires": [
            [
                "4dfee758a3812ea5"
            ]
        ]
    },
    {
        "id": "594b03bc7eea879e",
        "type": "mqtt out",
        "z": "79859e535099be0e",
        "g": "c0fa48505f5c7846",
        "name": "",
        "topic": "",
        "qos": "0",
        "retain": "false",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "751ec40a6956d4f9",
        "x": 3050,
        "y": 1000,
        "wires": []
    },
    {
        "id": "a874cc7a560dc780",
        "type": "inject",
        "z": "79859e535099be0e",
        "d": true,
        "g": "981c0bbbbf419219",
        "name": "",
        "props": [],
        "repeat": "3",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 130,
        "y": 360,
        "wires": [
            [
                "227355e9732d65dd"
            ]
        ]
    },
    {
        "id": "227355e9732d65dd",
        "type": "function",
        "z": "79859e535099be0e",
        "g": "981c0bbbbf419219",
        "name": "è¨­å‚™æ¸…å–®",
        "func": "// è¨­å®šè¨­å‚™æ¸…å–®\nvar devices = context.get('devices') || [\n   11,12,13,\n    14,\n   15,16,17,18,19\n    ]; // é»˜èªè¨­å‚™æ¸…å–®\n// ç‚ºæ¯å€‹è¨­å‚™ç”Ÿæˆä¸€æ¢æ¶ˆæ¯\nvar msgs = devices.map(deviceID => {\n    return {\n        deviceID: deviceID // å°‡è¨­å‚™ ID æ·»åŠ åˆ°æ¶ˆæ¯ä¸­\n    };\n});\n\n// è¿”å›æ‰€æœ‰æ¶ˆæ¯\nreturn [msgs];\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 280,
        "y": 360,
        "wires": [
            [
                "a2b77a17d37084df"
            ]
        ]
    },
    {
        "id": "a2b77a17d37084df",
        "type": "function",
        "z": "79859e535099be0e",
        "g": "981c0bbbbf419219",
        "name": "è©¢å•åœ°å€(P404)",
        "func": "/**\n * P404 æŸ¥è©¢æŒ‡ä»¤ç”¢ç”Ÿå™¨ï¼ˆä¸å« CRCï¼‰\n * è¼¸å‡ºï¼šmsg.payload = Buffer (ä¸å« CRC çš„ Modbus æŒ‡ä»¤)\n *\n * ä½¿ç”¨æ–¹å¼ï¼šè«‹ä¸²æ¥ crc_builder ç¯€é»è™•ç† CRC\n */\n\n// ç²å–ç•¶å‰è¨­å‚™ ID\nvar deviceID = msg.deviceID;\n\n// è¨­å®šåƒæ•¸\nvar functionCode = 0x03;           // åŠŸèƒ½ç¢¼ï¼šè®€å–ä¿æŒæš«å­˜å™¨(Holding Register)\nvar startAddress = 2090;            // èµ·å§‹åœ°å€\nvar quantity = 4;                  // è®€å–æ•¸é‡\n\n// å°‡èµ·å§‹åœ°å€å’Œæ•¸é‡è½‰æ›ç‚ºå…©å€‹å­—ç¯€\nvar startAddressHigh = (startAddress >> 8) & 0xFF; // é«˜ä½\nvar startAddressLow = startAddress & 0xFF;        // ä½ä½\nvar quantityHigh = (quantity >> 8) & 0xFF;        // é«˜ä½\nvar quantityLow = quantity & 0xFF;               // ä½ä½\n\n// çµ„è£æŒ‡ä»¤ï¼ˆä¸å« CRCï¼‰\nvar message = [\n    deviceID,            // è¨­å‚™åœ°å€\n    functionCode,        // åŠŸèƒ½ç¢¼\n    startAddressHigh,    // èµ·å§‹åœ°å€é«˜ä½\n    startAddressLow,     // èµ·å§‹åœ°å€ä½ä½\n    quantityHigh,        // æ•¸é‡é«˜ä½\n    quantityLow          // æ•¸é‡ä½ä½\n];\n\n// å°‡æŒ‡ä»¤å­˜å…¥ msg.payload\nmsg.payload = Buffer.from(message);\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 460,
        "y": 360,
        "wires": [
            [
                "2e1a783c450d4d9e"
            ]
        ]
    },
    {
        "id": "ede4f9311185a799",
        "type": "function",
        "z": "79859e535099be0e",
        "g": "f6abec360d64a7b8",
        "name": "æ›´æ–°å¿«å– (single brightness, MQTT)",
        "func": "/**\n * MQTT â†’ flow å¿«å–\n * topic: homeassistant/light/single/{id}/{channel}/set/brightness\n * payload: number (0â€“255)\n */\nconst topic = String(msg.topic || \"\");\nconst parts = topic.split(\"/\");\n\n// é©—è­‰ topic æ ¼å¼\nif (parts.length < 7 || parts[0] !== \"homeassistant\" || parts[1] !== \"light\" || parts[2] !== \"single\" || parts[5] !== \"set\" || parts[6] !== \"brightness\") {\n    return null; // æ ¼å¼ä¸ç¬¦ç›´æ¥å¿½ç•¥\n}\n\nconst id = parts[3];\nconst ch = parts[4];\nconst key = `single_${id}_${ch}_brightness`;\n\n// é©—è­‰ payload\nlet val = Number(msg.payload);\nif (!Number.isFinite(val)) return null;\nval = Math.max(0, Math.min(255, Math.round(val)));\n\n// æ›´æ–°å¿«å–\nflow.set(key, val);\nnode.status({ fill: \"green\", shape: \"dot\", text: `${key}=${val}` });\n\nreturn null; // åªæ›´æ–°å¿«å–ï¼Œä¸å¾€ä¸‹å‚³\n",
        "outputs": 0,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1440,
        "y": 80,
        "wires": []
    },
    {
        "id": "aaa562fc313338fb",
        "type": "mqtt in",
        "z": "79859e535099be0e",
        "g": "f6abec360d64a7b8",
        "name": "",
        "topic": "homeassistant/light/single/+/+/set/brightness",
        "qos": "0",
        "datatype": "auto-detect",
        "broker": "751ec40a6956d4f9",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 1090,
        "y": 80,
        "wires": [
            [
                "ede4f9311185a799"
            ]
        ]
    },
    {
        "id": "51bb7ebb86b32127",
        "type": "inject",
        "z": "79859e535099be0e",
        "g": "0e61521047ef3674",
        "name": "æ‰‹å‹• Reset",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 1300,
        "y": 880,
        "wires": [
            [
                "9203517f86f8b62e"
            ]
        ]
    },
    {
        "id": "7021d679c1fcbd80",
        "type": "function",
        "z": "79859e535099be0e",
        "g": "0e61521047ef3674",
        "name": "æ”¶åˆ°å›æ‡‰ â†’ è§£é–",
        "func": "let t = flow.get(\"currentTimeout\");\nif (t) { clearTimeout(t); flow.set(\"currentTimeout\", null); }\n\nglobal.set(\"waitingReply\", false);\nflow.set(\"currentCmd\", null);\n\nreturn { payload: null }; // å–šé†’ã€Œç™¼é€æµç¨‹ + timeoutã€é€ä¸‹ä¸€ç­†\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2190,
        "y": 1120,
        "wires": [
            [
                "97bb13b4a9ed0afe"
            ]
        ]
    },
    {
        "id": "07e4647b6b26109e",
        "type": "function",
        "z": "79859e535099be0e",
        "g": "0e61521047ef3674",
        "name": "éæ¿¾é›œè¨Š/æ®˜åŒ…",
        "func": "const buf = msg.payload;\nif (!Buffer.isBuffer(buf) || buf.length < 4) {  // ä¾å”è­°èª¿æ•´é–€æª»\n    return null; // ç•¥éï¼Œè®“ timeout æ©Ÿåˆ¶è™•ç†\n}\nreturn msg; // é€šéæ‰å»è§£é–\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2000,
        "y": 1120,
        "wires": [
            [
                "7021d679c1fcbd80"
            ]
        ]
    },
    {
        "id": "9203517f86f8b62e",
        "type": "function",
        "z": "79859e535099be0e",
        "g": "0e61521047ef3674",
        "name": "é‡ç½®ä½‡åˆ—",
        "func": "// ä¸€éµæ¸…é™¤ + è§£é– + å–šé†’ï¼ˆå–®è¼¸å‡ºï¼‰\n// out[0] â†’ {payload:null} å–šé†’ã€Œç™¼é€æµç¨‹ + timeoutã€\n\n// 1) åœæ‰é€¾æ™‚è¨ˆæ™‚å™¨ï¼ˆé¿å…å¹½éˆå›å‘¼ï¼‰\nconst t = flow.get(\"currentTimeout\");\nif (t) { clearTimeout(t); }\n\n// 2) æ¸…é™¤åœ¨é€”ç‹€æ…‹\nflow.set(\"currentTimeout\", null);\nflow.set(\"currentCmd\", null);\nglobal.set(\"waitingReply\", false);\n\n// 3) æ¸…ç©ºä½‡åˆ—\nglobal.set(\"commandsQueue\", []);\n\n// 4) é¡¯ç¤ºç‹€æ…‹ï¼ˆæ–¹ä¾¿æª¢æŸ¥ï¼‰\nnode.status({\n  fill: \"green\",\n  shape: \"ring\",\n  text: \"å·²æ¸…é™¤, queue=0\"\n});\n\n// 5) å›å‚³ï¼šç›´æ¥å–šé†’ç™¼é€æµç¨‹\nreturn { payload: null };\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1440,
        "y": 880,
        "wires": [
            [
                "97bb13b4a9ed0afe"
            ]
        ]
    },
    {
        "id": "0fbd9354e637f4c5",
        "type": "debug",
        "z": "79859e535099be0e",
        "g": "0e61521047ef3674",
        "name": "å›è¦†",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 2270,
        "y": 860,
        "wires": []
    },
    {
        "id": "75ee7aea6cde6566",
        "type": "debug",
        "z": "79859e535099be0e",
        "g": "0e61521047ef3674",
        "name": "ç™¼é€",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1750,
        "y": 860,
        "wires": []
    },
    {
        "id": "97bb13b4a9ed0afe",
        "type": "function",
        "z": "79859e535099be0e",
        "g": "0e61521047ef3674",
        "name": "ç™¼é€æµç¨‹ + timeout",
        "func": "// === ç™¼é€æµç¨‹ + timeout ===\n// åŠŸèƒ½ï¼š\n// 1. å¾ commandsQueue å–å‡ºä¸‹ä¸€ç­†æŒ‡ä»¤ä¸¦ç™¼é€\n// 2. å•Ÿå‹• Timeout + Retry æ©Ÿåˆ¶\n// 3. è¶…é MAX_RETRY â†’ ä¸Ÿæ‰è©²ç­†ï¼Œç¹¼çºŒä¸‹ä¸€ç­†\n// 4. éƒ¨ç½²å¾Œè‡ªå‹•è§£é–ï¼ˆé¿å… waitingReply å¡æ­»ï¼‰\n\nconst TIMEOUT_MS = 200; // å»ºè­° 600~1200msï¼Œä¾è¨­å‚™å›è¦†æ™‚é–“èª¿æ•´\nconst MAX_RETRY = 2;   // æœ€å¤§é‡é€æ¬¡æ•¸ï¼›ç¸½ç™¼é€æ¬¡æ•¸ = 1 + MAX_RETRY\n\n// === Queue ç‹€æ…‹ ===\nlet queue = global.get(\"commandsQueue\");\nif (!Array.isArray(queue)) {\n  queue = [];\n  global.set(\"commandsQueue\", queue);\n}\n\nconst busy = !!global.get(\"waitingReply\");\n\n// === è‹¥å¿™ç¢Œæˆ–ä½‡åˆ—ç©º â†’ ä¸å‹•ä½œ ===\nif (busy || queue.length === 0) return [null, null];\n\n// === å– FIFO å‡ºåˆ— ===\nconst cmd = queue.shift();\nglobal.set(\"commandsQueue\", queue);\nglobal.set(\"waitingReply\", true);\n\n// æº–å‚™è¨Šæ¯ï¼ˆå« retry è¨ˆæ•¸ï¼‰\nlet outMsg = { payload: cmd, retry: 0 };\nflow.set(\"currentCmd\", outMsg);\n\n// === Timeout + Retry æ©Ÿåˆ¶ ===\nfunction armTimeout(cur) {\n  const timer = setTimeout(() => {\n    cur.retry += 1;\n\n    if (cur.retry <= MAX_RETRY) {\n      // Retry â†’ é‡é€åŒä¸€ç­†\n      flow.set(\"currentCmd\", cur);\n      node.send([cur, null]);  // å†é€ä¸€æ¬¡åˆ° TCP\n      armTimeout(cur);         // é‡æ–°æ› Timeout\n    } else {\n      // è¶…é MAX_RETRY â†’ ä¸Ÿæ£„é€™ç­†ï¼Œè§£é–ç¹¼çºŒä¸‹ä¸€ç­†\n      global.set(\"waitingReply\", false);\n      flow.set(\"currentCmd\", null);\n      flow.set(\"currentTimeout\", null);\n\n      node.status({\n        fill: \"red\",\n        shape: \"ring\",\n        text: \"æŒ‡ä»¤è¶…æ™‚å·²ä¸Ÿæ£„\"\n      });\n\n      // è§¸ç™¼ä¸‹ä¸€ç­†\n      node.send([null, { payload: { trigger: true, reason: \"timeout\" } }]);\n    }\n  }, TIMEOUT_MS);\n\n  flow.set(\"currentTimeout\", timer);\n}\n\n// === é€å‡ºç¬¬ä¸€ç­†ä¸¦æ› Timeout ===\narmTimeout(outMsg);\nreturn [outMsg, null];",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "// éƒ¨ç½²ç¯€é»å¾Œï¼Œæ­¤è™•æ·»åŠ çš„ä»£ç¢¼å°‡é‹è¡Œä¸€æ¬¡ã€‚ \n// éƒ¨ç½²åˆå§‹åŒ–ï¼šè‡ªå‹•æ¸…ç©º queue & è§£é–ï¼Œé¿å…éƒ¨ç½²å¾Œå¡æ­»\nglobal.set(\"commandsQueue\", []);\nglobal.set(\"waitingReply\", false);\nflow.set(\"currentCmd\", null);\nflow.set(\"currentTimeout\", null);\n\nnode.status({ fill: \"grey\", shape: \"ring\", text: \"éƒ¨ç½²å¾Œå·²é‡ç½®\" });",
        "finalize": "// ç¯€é»æ­£åœ¨åœæ­¢æˆ–é‡æ–°éƒ¨ç½²æ™‚ï¼Œå°‡é‹è¡Œæ­¤è™•æ·»åŠ çš„ä»£ç¢¼ã€‚ \n// åœæ­¢æˆ–é‡æ–°éƒ¨ç½²æ™‚æ¸…æ‰è¨ˆæ™‚å™¨\n\nconst t = flow.get(\"currentTimeout\");\nif (t) {\n    clearTimeout(t);\n}\nflow.set(\"currentTimeout\", null);\n\nglobal.set(\"commandsQueue\", []);\nglobal.set(\"waitingReply\", false);\nflow.set(\"currentCmd\", null);",
        "libs": [],
        "x": 1510,
        "y": 940,
        "wires": [
            [
                "75ee7aea6cde6566",
                "870d64ed9aef6fec"
            ],
            [
                "94438fc93e4fd89b"
            ]
        ],
        "info": "ã€åŠŸèƒ½èªªæ˜ã€‘\næ­¤ç¯€é»è² è²¬ï¼š\n1. å¾ commandsQueue ä½‡åˆ—ä¸­å–å‡ºä¸‹ä¸€ç­†æŒ‡ä»¤\n2. ç™¼é€è‡³ TCP ç¯€é»\n3. å•Ÿå‹• Retry æ©Ÿåˆ¶ï¼ˆé è¨­æœ€å¤šé‡é€ 2 æ¬¡ï¼‰\n4. è‹¥æˆåŠŸå›æ‡‰ â†’ ç”± handle_reply è§£é–ä½‡åˆ—\n5. è‹¥å¤±æ•—è¶…æ™‚ â†’ è‡ªå‹•è§£é–ä¸¦è§¸ç™¼ä¸‹ä¸€ç­†é€å‡º\n"
    },
    {
        "id": "894d1465d5eb9810",
        "type": "function",
        "z": "79859e535099be0e",
        "g": "0e61521047ef3674",
        "name": "åŠ å…¥ä½‡åˆ—",
        "func": "// === åŠ å…¥ä½‡åˆ— ===\n// åŠŸèƒ½ï¼š\n// 1. æ¥æ”¶æŒ‡ä»¤ (msg.payload)\n// 2. æ¨å…¥ commandsQueue\n// 3. è‹¥ queue æ»¿ â†’ è‡ªå‹•æ¸…ç©º (Reset)\n// 4. è‹¥æœªå¿™ç¢Œ â†’ å–šé†’ç™¼é€æµç¨‹\n\nlet queue = global.get(\"commandsQueue\") || [];\nlet cmd = msg.payload;\n\n// ğŸ”¹ å¦‚æœæ˜¯ Arrayï¼Œè‡ªå‹•è½‰ Buffer\nif (Array.isArray(cmd)) {\n    cmd = Buffer.from(cmd);\n}\n\nconst MAX_QUEUE = 50;\n\n// === Queue æ»¿ â†’ è‡ªå‹• Reset ===\nif (queue.length >= MAX_QUEUE) {\n    // æ¸…ç©ºæ‰€æœ‰ç‹€æ…‹\n    global.set(\"commandsQueue\", []);\n    global.set(\"waitingReply\", false);\n    flow.set(\"currentCmd\", null);\n    flow.set(\"currentTimeout\", null);\n\n    node.status({\n        fill: \"red\",\n        shape: \"ring\",\n        text: \"âš ï¸ ä½‡åˆ—æ»¿ï¼Œè‡ªå‹•æ¸…ç©º\"\n    });\n\n    return { payload: null };  // å–šé†’ã€Œç™¼é€æµç¨‹ã€ï¼Œä½† queue å·²æ¸…ç©º\n}\n\n// === æ­£å¸¸æƒ…æ³ â†’ push é€²ä½‡åˆ— ===\nqueue.push(cmd);\nglobal.set(\"commandsQueue\", queue);\n\n// === ç‹€æ…‹é¡¯ç¤º ===\nnode.status({\n    fill: \"green\",\n    shape: \"dot\",\n    text: `ä½‡åˆ—é•·åº¦: ${queue.length}`\n});\n\n// === è‹¥ç›®å‰æ²’æœ‰åœ¨ç­‰å›è¦† â†’ è§¸ç™¼ç™¼é€æµç¨‹ ===\nlet waitingReply = global.get(\"waitingReply\") || false;\nif (!waitingReply) {\n    return { payload: null };   // âœ… å–šé†’ã€Œç™¼é€æµç¨‹ã€\n}\nreturn null;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1300,
        "y": 940,
        "wires": [
            [
                "97bb13b4a9ed0afe"
            ]
        ]
    },
    {
        "id": "31f543d38254a0ac",
        "type": "function",
        "z": "79859e535099be0e",
        "g": "c0fa48505f5c7846",
        "name": "è§£æå›æ‡‰(P404)",
        "func": "// === Channel å°æ‡‰ byte æ˜ å°„ï¼ˆæ ¹æ“šé€šé“æ±ºå®šäº®åº¦èˆ‡è‰²æº«ä½å…ƒï¼‰===\nconst channelByteMap = {\n    // é›™è‰²æº«é€šé“ï¼ˆå«äº®åº¦èˆ‡è‰²æº«ï¼‰\n    \"a\": { type: \"dual\", brightnessByte: 4, colortempByte: 6 },\n    \"b\": { type: \"dual\", brightnessByte: 8, colortempByte: 10 },\n    // å–®è‰²æº«é€šé“ï¼ˆåªæœ‰äº®åº¦ï¼‰\n    \"1\": { type: \"single\", brightnessByte: 4 },\n    \"2\": { type: \"single\", brightnessByte: 6 },\n    \"3\": { type: \"single\", brightnessByte: 8 },\n    \"4\": { type: \"single\", brightnessByte: 10 },\n};\n\n// === ç‡ˆå…·é…ç½®æ¸…å–® ===\n// æ¯ç­†ç‡ˆå…·åŒ…å«åç¨±ã€Modbus IDã€é€šé“ç·¨è™Ÿï¼ˆchannelï¼‰\nconst lights = [\n    {id: 11, channel: \"1\" },\n    {id: 12, channel: \"1\" },\n    {id: 12, channel: \"2\" },\n    {id: 12, channel: \"3\" },\n    {id: 13, channel: \"1\" },\n    {id: 13, channel: \"2\" },\n    {id: 13, channel: \"3\" },\n    {id: 14, channel: \"a\" },\n    {id: 14, channel: \"b\" },\n    {id: 15, channel: \"1\" },\n    {id: 15, channel: \"2\" },\n    {id: 16, channel: \"1\" },\n    {id: 17, channel: \"1\" },\n    {id: 18, channel: \"1\" },\n    {id: 18, channel: \"2\" },\n    {id: 19, channel: \"1\" },\n    {id: 19, channel: \"2\" },\n];\n\n// === è‰²æº«è½‰æ›ï¼šModbus æ•¸å€¼ â†’ miredï¼ˆHA ä½¿ç”¨ï¼‰===\nfunction getColortempHA(modbusValue) {\n    const MIRED_MIN = 154;// 6500K\n    const MIRED_MAX = 370;// 2700K\n    return Math.round(MIRED_MAX + modbusValue / 100 * (MIRED_MIN - MIRED_MAX));\n}\n\n// === Modbus CRC é©—è­‰å‡½å¼ ===\nfunction verifyCRC(buf) {\n    let crc = 0xFFFF;\n    for (let i = 0; i < buf.length - 2; i++) {\n        crc ^= buf[i];\n        for (let j = 0; j < 8; j++) {\n            crc = (crc & 1) ? ((crc >> 1) ^ 0xA001) : (crc >> 1);\n        }\n    }\n    const crcLow = crc & 0xFF;\n    const crcHigh = (crc >> 8) & 0xFF;\n    return (crcLow === buf[buf.length - 2]) && (crcHigh === buf[buf.length - 1]);\n}\n\n// === ä¸»ç¨‹å¼é–‹å§‹ ===\nconst buffer = msg.payload;\n\n// === åŸºç¤é˜²éŒ¯æª¢æŸ¥ ===\nif (!Buffer.isBuffer(buffer)) return null;       // è³‡æ–™å¿…é ˆæ˜¯ Buffer\nif (buffer.length !== 13) return null;           // é•·åº¦éœ€ç‚º 13 bytesï¼ˆå›ºå®šæ ¼å¼ï¼‰\n\nconst id = buffer[0];                            // è£ç½® ID\nconst funcCode = buffer[1];                      // åŠŸèƒ½ç¢¼ï¼Œæ‡‰ç‚º 0x03\nconst byteCount = buffer[2];                     // è³‡æ–™é•·åº¦ï¼Œæ‡‰ç‚º 13\n\nif (funcCode !== 0x03 || byteCount !== 8) return null;\nif (!verifyCRC(buffer)) return null;             // CRC é©—è­‰å¤±æ•—å‰‡ä¸Ÿæ£„\n\n// === é–‹å§‹è§£ææ¯ç­†ç‡ˆå…· ===\nconst mqttMsgs = [];\n\nfor (const light of lights) {\n    if (light.id !== id) continue;  // åƒ…è™•ç†æ­¤å°åŒ…å°æ‡‰çš„ ID\n\n    const info = channelByteMap[light.channel];\n    if (!info) continue;  // channel ç„¡å°æ‡‰å®šç¾©å‰‡è·³é\n\n    const deviceID = light.id;\n    const channel = light.channel;\n    const type = info.type;\n    const brightness = buffer[info.brightnessByte];\n\n    // çµ„åˆ MQTT topic è·¯å¾‘\n    const stateTopic = `homeassistant/light/${type}/${deviceID}/${channel}`;\n    const setTopic = `${stateTopic}/set`;\n\n    // === é›™è‰²æº«ç‡ˆå…·è™•ç†é‚è¼¯ ===\n    if (type === \"dual\") {\n        // âœ… æ ¹æ“šäº®åº¦æ±ºå®š ON/OFF ç‹€æ…‹ï¼Œä¸¦æ±ºå®šæ˜¯å¦é€äº®åº¦æŒ‡ä»¤\n        if (brightness === 0) {\n            mqttMsgs.push({ topic: `${stateTopic}/state`, payload: \"OFF\" });\n        } else {\n            mqttMsgs.push(\n                { topic: `${stateTopic}/state`, payload: \"ON\" },\n                { topic: `${stateTopic}/brightness`, payload: brightness.toString() },\n                { topic: `${setTopic}/brightness`, payload: brightness.toString() }\n            );\n        }\n\n        // âœ… ç„¡è«–äº®åº¦ç‚ºä½•éƒ½é€ colortemp\n        const colortempModbus = buffer[info.colortempByte];\n        const colortempMired = getColortempHA(colortempModbus);\n\n        mqttMsgs.push(\n            { topic: `${stateTopic}/colortemp`, payload: colortempMired.toString() },\n            { topic: `${setTopic}/colortemp`, payload: colortempMired.toString() }\n        );\n    }\n\n    // === å–®è‰²æº«ç‡ˆå…·è™•ç†é‚è¼¯ ===\n    if (type === \"single\") {\n        if (brightness === 0) {\n            mqttMsgs.push({ topic: `${stateTopic}/state`, payload: \"OFF\" });\n        } else {\n            mqttMsgs.push(\n                { topic: `${stateTopic}/state`, payload: \"ON\" },\n                { topic: `${stateTopic}/brightness`, payload: brightness.toString() },\n                { topic: `${setTopic}/brightness`, payload: brightness.toString() }\n            );\n        }\n    }\n}\n\n// === è¼¸å‡ºæ‰€æœ‰çµ„åˆçš„ MQTT è¨Šæ¯é™£åˆ— ===\nreturn [mqttMsgs];\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2720,
        "y": 980,
        "wires": [
            [
                "23bf88cce761058f"
            ]
        ]
    },
    {
        "id": "9501c196dc6f5297",
        "type": "mqtt in",
        "z": "79859e535099be0e",
        "g": "f6abec360d64a7b8",
        "name": "",
        "topic": "homeassistant/light/dual/+/+/set/brightness",
        "qos": "0",
        "datatype": "auto-detect",
        "broker": "751ec40a6956d4f9",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 1080,
        "y": 140,
        "wires": [
            [
                "6b4e8d812e09c533"
            ]
        ]
    },
    {
        "id": "404907156d8b1727",
        "type": "mqtt in",
        "z": "79859e535099be0e",
        "g": "f6abec360d64a7b8",
        "name": "",
        "topic": "homeassistant/light/dual/+/+/set/colortemp",
        "qos": "0",
        "datatype": "auto-detect",
        "broker": "751ec40a6956d4f9",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 1090,
        "y": 200,
        "wires": [
            [
                "c70aa66203fa62c6"
            ]
        ]
    },
    {
        "id": "6b4e8d812e09c533",
        "type": "function",
        "z": "79859e535099be0e",
        "g": "f6abec360d64a7b8",
        "name": "æ›´æ–°å¿«å– dual_brightness",
        "func": "/**\n * topic: homeassistant/light/dual/{id}/{channel}/set/brightness\n * payload: 0~255\n */\nconst parts = String(msg.topic||\"\").split(\"/\");\nif (parts.length<7 || parts[0]!=='homeassistant' || parts[1]!=='light' || parts[2]!=='dual' || parts[5]!=='set' || parts[6]!=='brightness') return null;\nconst id = parts[3];\nconst ch = (parts[4]||'').toLowerCase();\nlet val = Number(msg.payload);\nif (!Number.isFinite(val)) return null;\nval = Math.max(0, Math.min(255, Math.round(val)));\nconst key = `dual_${id}_${ch}_brightness`;\nflow.set(key, val);\nnode.status({fill:'green',shape:'dot',text:`${key}=${val}`});\nreturn null;",
        "outputs": 0,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1410,
        "y": 140,
        "wires": []
    },
    {
        "id": "c70aa66203fa62c6",
        "type": "function",
        "z": "79859e535099be0e",
        "g": "f6abec360d64a7b8",
        "name": "æ›´æ–°å¿«å– dual_colortemp (mired)",
        "func": "/**\n * topic: homeassistant/light/dual/{id}/{channel}/set/colortemp\n * payload: mired å»ºè­° 154~370\n */\nconst parts = String(msg.topic||\"\").split(\"/\");\nif (parts.length<7 || parts[0]!=='homeassistant' || parts[1]!=='light' || parts[2]!=='dual' || parts[5]!=='set' || parts[6]!=='colortemp') return null;\nconst id = parts[3];\nconst ch = (parts[4]||'').toLowerCase();\nlet mired = Number(msg.payload);\nif (!Number.isFinite(mired)) return null;\n// å¤¾åœ¨å¸¸è¦‹ç¯„åœå…§ï¼Œé¿å…ç•°å¸¸å€¼\nmired = Math.max(154, Math.min(370, Math.round(mired)));\nconst key = `dual_${id}_${ch}_colortemp`;\nflow.set(key, mired);\nnode.status({fill:'blue',shape:'dot',text:`${key}=${mired}mired`});\nreturn null;",
        "outputs": 0,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1440,
        "y": 200,
        "wires": []
    },
    {
        "id": "1fb83ff1a5382b63",
        "type": "inject",
        "z": "79859e535099be0e",
        "g": "3a585159d7619ee6",
        "name": "åŠ å…¥ Discovery",
        "props": [
            {
                "p": "action",
                "v": "add",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 160,
        "y": 140,
        "wires": [
            [
                "928b6d4010212bf9"
            ]
        ]
    },
    {
        "id": "0cf2ed797f2abc88",
        "type": "inject",
        "z": "79859e535099be0e",
        "g": "3a585159d7619ee6",
        "name": "æ¸…é™¤ Discovery",
        "props": [
            {
                "p": "action",
                "v": "clear",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 160,
        "y": 180,
        "wires": [
            [
                "928b6d4010212bf9"
            ]
        ]
    },
    {
        "id": "d8acce7dd404c11a",
        "type": "function",
        "z": "79859e535099be0e",
        "g": "3a585159d7619ee6",
        "name": "Discovery climate MQTT",
        "func": "// ç©ºèª¿è¨­å‚™é…ç½®ç”Ÿæˆå™¨\n// æ”¯æ´: HVAC ç©ºèª¿æ§åˆ¶\n\n// ============ ç©ºèª¿è¨­å‚™å®šç¾© ============\nlet devices = msg.devices || [];\n\n// ============ è¨»å†Š/æ¸…é™¤é‚è¼¯ ============\nlet msgs = devices.map(dev => {\n    let path = `${dev.type}/${dev.module_id}/${dev.channel}`;\n    let unique_id = `${dev.type}_${dev.module_id}_${dev.channel}`;\n    let topic = `homeassistant/climate/${unique_id}/config`;\n    let payload;\n\n    if (msg.action === \"clear\") {\n        payload = \"\";\n    } else if (msg.action === \"add\") {\n        payload = {\n            name: dev.name,\n            unique_id: unique_id,\n            modes: [\"off\", \"cool\", \"heat\", \"dry\", \"fan_only\", \"auto\"],\n            mode_command_topic: `homeassistant/hvac/${path}/mode/set`,\n            mode_state_topic: `homeassistant/hvac/${path}/mode/state`,\n            temperature_command_topic: `homeassistant/hvac/${path}/temperature/set`,\n            temperature_state_topic: `homeassistant/hvac/${path}/temperature/state`,\n            min_temp: 16,\n            max_temp: 30,\n            temp_step: 1,\n            current_temperature_topic: `homeassistant/hvac/${path}/current_temperature`,\n            fan_modes: [\"auto\", \"low\", \"medium\", \"high\"],\n            fan_mode_command_topic: `homeassistant/hvac/${path}/fan/set`,\n            fan_mode_state_topic: `homeassistant/hvac/${path}/fan/state`,\n            retain: true,\n            optimistic: true\n        };\n        payload = JSON.stringify(payload);\n    }\n\n    return { topic, payload };\n});\n\nreturn [msgs];\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 510,
        "y": 160,
        "wires": [
            [
                "5e251390605dc1d7"
            ]
        ]
    },
    {
        "id": "5e251390605dc1d7",
        "type": "mqtt out",
        "z": "79859e535099be0e",
        "g": "3a585159d7619ee6",
        "name": "ç™¼é€åˆ° MQTT Broker",
        "topic": "",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "751ec40a6956d4f9",
        "x": 740,
        "y": 160,
        "wires": []
    },
    {
        "id": "f1e9f24be05b2016",
        "type": "mqtt in",
        "z": "79859e535099be0e",
        "d": true,
        "g": "cb7ac42eb2b47bae",
        "name": "",
        "topic": "homeassistant/hvac/i2/+/+/mode/set",
        "qos": "0",
        "datatype": "auto-detect",
        "broker": "751ec40a6956d4f9",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 240,
        "y": 1000,
        "wires": [
            [
                "6c88bbdf905ec93e",
                "efd311ccaaf04dde"
            ]
        ]
    },
    {
        "id": "52af17a09885da8f",
        "type": "mqtt in",
        "z": "79859e535099be0e",
        "d": true,
        "g": "cb7ac42eb2b47bae",
        "name": "",
        "topic": "homeassistant/hvac/i2/+/+/temperature/set",
        "qos": "0",
        "datatype": "auto-detect",
        "broker": "751ec40a6956d4f9",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 220,
        "y": 1040,
        "wires": [
            [
                "6c88bbdf905ec93e",
                "efd311ccaaf04dde"
            ]
        ]
    },
    {
        "id": "de248c92ee121b6a",
        "type": "function",
        "z": "79859e535099be0e",
        "d": true,
        "g": "cb7ac42eb2b47bae",
        "name": "i2 command",
        "func": "const { id, port, device, key } = msg.payload;\n\n// èµ·å§‹æš«å­˜å™¨åœ°å€ï¼ˆä½ è¦å¯«å…¥çš„ä½ç½®ï¼‰\nconst startAddress = 0x01A5;     // å°æ‡‰ 42022\nconst registerCount = 2;         // å¯«å…¥å…©å€‹æš«å­˜å™¨\nconst byteCount = registerCount * 2;  // æ¯å€‹æš«å­˜å™¨ 2 bytes\n\n// å»ºç«‹è³‡æ–™å€ï¼ˆ2 å€‹æš«å­˜å™¨ï¼‰\nconst dataBytes = [\n    0x00, port,       // ç¬¬ 1 å€‹æš«å­˜å™¨ï¼šport = 1 â†’ 00 01\n    device, key       // ç¬¬ 2 å€‹æš«å­˜å™¨ï¼šdevice=2, key=3 â†’ 02 03\n];\n\n// çµ„åˆå®Œæ•´ frameï¼ˆä¸å« CRCï¼‰\nlet frame = [\n    id,\n    0x10,  // Function code: Write multiple registers\n    (startAddress >> 8) & 0xFF,\n    startAddress & 0xFF,\n    0x00, registerCount,\n    byteCount,\n    ...dataBytes\n];\n\n// è¨ˆç®— CRC16ï¼ˆMODBUSï¼‰\nfunction crc16Modbus(buf) {\n    let crc = 0xFFFF;\n    for (let b of buf) {\n        crc ^= b;\n        for (let i = 0; i < 8; i++) {\n            crc = (crc >> 1) ^ ((crc & 1) ? 0xA001 : 0);\n        }\n    }\n    return [crc & 0xFF, (crc >> 8) & 0xFF];\n}\n\nconst crc = crc16Modbus(frame);\nframe.push(...crc);\n\n// é™¤éŒ¯è¼¸å‡ºï¼ˆHEX å¯è®€ï¼‰\nmsg.debug = frame.map(b => b.toString(16).padStart(2, '0')).join(' ');\n\n// å¯¦éš›ç™¼é€ buffer\nmsg.payload = Buffer.from(frame);\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 770,
        "y": 1040,
        "wires": [
            [
                "9ef757eadc58071e"
            ]
        ]
    },
    {
        "id": "64aa699af43a6eb4",
        "type": "mqtt out",
        "z": "79859e535099be0e",
        "d": true,
        "g": "cb7ac42eb2b47bae",
        "name": "homeassistant/hvac/i2/+/+/mode/state",
        "topic": "",
        "qos": "1",
        "retain": "false",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "751ec40a6956d4f9",
        "x": 715,
        "y": 1080,
        "wires": [],
        "l": false
    },
    {
        "id": "6c88bbdf905ec93e",
        "type": "function",
        "z": "79859e535099be0e",
        "d": true,
        "g": "cb7ac42eb2b47bae",
        "name": "id, port, device, key",
        "func": "// topic æ ¼å¼ï¼šhomeassistant/hvac/i2/<id>/<port>/<type>/set\nconst [, , , id, port, type] = msg.topic.split('/');\nconst val = msg.payload.toString().toLowerCase();\n\nconst device = 0;\nconst defaultCoolTemp = 25;\n\nlet key;\nlet stateMsgs = [];\n\n// === Mode è¨­å®š ===\nif (type === \"mode\") {\n    if (val === \"cool\") {\n        key = 1;\n        stateMsgs.push(\n            { topic: `homeassistant/hvac/i2/${id}/${port}/mode/state`, payload: \"cool\", retain: true },\n            { topic: `homeassistant/hvac/i2/${id}/${port}/temperature/state`, payload: String(defaultCoolTemp), retain: true }\n        );\n    } else if (val === \"off\") {\n        key = 0;\n        stateMsgs.push(\n            { topic: `homeassistant/hvac/i2/${id}/${port}/mode/state`, payload: \"off\", retain: true }\n        );\n    }\n}\n\n// === Temperature è¨­å®š ===\nif (type === \"temperature\") {\n    const temp = parseInt(val);\n    key = temp;\n    stateMsgs.push(\n        { topic: `homeassistant/hvac/i2/${id}/${port}/temperature/state`, payload: String(temp), retain: true },\n        { topic: `homeassistant/hvac/i2/${id}/${port}/mode/state`, payload: \"cool\", retain: true }\n    );\n}\n\n// === Output #1: Modbus æŒ‡ä»¤ ===\nconst mainMsg = {\n    payload: { id: +id, port: +port, device, key }\n};\n\n// === è¼¸å‡º ===\n// Output[0] = Modbus æŒ‡ä»¤\n// Output[1] = å¤šç­† MQTT ç‹€æ…‹\nreturn [mainMsg, stateMsgs];\n",
        "outputs": 2,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 570,
        "y": 1040,
        "wires": [
            [
                "de248c92ee121b6a",
                "3b0248d05a49efb6"
            ],
            [
                "64aa699af43a6eb4"
            ]
        ]
    },
    {
        "id": "3b0248d05a49efb6",
        "type": "debug",
        "z": "79859e535099be0e",
        "d": true,
        "g": "cb7ac42eb2b47bae",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 715,
        "y": 1000,
        "wires": [],
        "l": false
    },
    {
        "id": "d9c41e07f78057e0",
        "type": "comment",
        "z": "79859e535099be0e",
        "d": true,
        "g": "77b1f027c533026f",
        "name": "TV  ON/OFFï¼ˆé»é–‹å…§å®¹ï¼‰",
        "info": "192.168.1.221 TCP:100\n\né›»è¦–ç‰†é›»è¦–é–‹\n\\xAA\\x11\\xFE\\x01\\x01\\x11\n\né›»è¦–ç‰†é›»è¦–é—œ\n\\xAA\\x11\\xFE\\x01\\x00\\x10",
        "x": 190,
        "y": 1200,
        "wires": []
    },
    {
        "id": "504019c6ff91850e",
        "type": "function",
        "z": "79859e535099be0e",
        "d": true,
        "g": "77b1f027c533026f",
        "name": "command (ON)",
        "func": "if (msg.payload !== \"ON\") return null;\n\n// è‡ªè¨‚è¦ç™¼é€çš„å®Œæ•´æŒ‡ä»¤\nconst command =[\n    0xAA, 0x11, 0xFE, 0x01, 0x01, 0x11  \n]\n\n\n// ç›´æ¥æ‰“åŒ…æˆ Buffer è¼¸å‡º\nmsg.payload = Buffer.from(command);\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 420,
        "y": 1220,
        "wires": [
            [
                "6bfe26334c3a9ef2",
                "fbb87579d6d438b3"
            ]
        ]
    },
    {
        "id": "f9176ac9d0761038",
        "type": "function",
        "z": "79859e535099be0e",
        "d": true,
        "g": "77b1f027c533026f",
        "name": "command (OFF)",
        "func": "if (msg.payload !== \"OFF\") return null;\n\n// è‡ªè¨‚è¦ç™¼é€çš„å®Œæ•´æŒ‡ä»¤\nconst command = [\n    0xAA, 0x11, 0xFE, 0x01, 0x00, 0x10\n];\n\n// ç›´æ¥æ‰“åŒ…æˆ Buffer è¼¸å‡º\nmsg.payload = Buffer.from(command);\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 420,
        "y": 1260,
        "wires": [
            [
                "6bfe26334c3a9ef2",
                "fbb87579d6d438b3"
            ]
        ]
    },
    {
        "id": "e5d907ba68258212",
        "type": "mqtt in",
        "z": "79859e535099be0e",
        "d": true,
        "g": "77b1f027c533026f",
        "name": "",
        "topic": "homeassistant/button/tv",
        "qos": "0",
        "datatype": "auto-detect",
        "broker": "751ec40a6956d4f9",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 190,
        "y": 1240,
        "wires": [
            [
                "504019c6ff91850e",
                "f9176ac9d0761038"
            ]
        ]
    },
    {
        "id": "6bfe26334c3a9ef2",
        "type": "debug",
        "z": "79859e535099be0e",
        "d": true,
        "g": "77b1f027c533026f",
        "name": "è¼¸å‡º",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 635,
        "y": 1260,
        "wires": [],
        "l": false
    },
    {
        "id": "acaa26475ad962d6",
        "type": "debug",
        "z": "79859e535099be0e",
        "d": true,
        "g": "77b1f027c533026f",
        "name": "å›æ‡‰",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1145,
        "y": 1240,
        "wires": [],
        "l": false
    },
    {
        "id": "92a69b61bf4be41c",
        "type": "comment",
        "z": "79859e535099be0e",
        "d": true,
        "g": "fee287b36585eb62",
        "name": "æ“´å¤§æ©Ÿæ§åˆ¶ï¼ˆé»é–‹å…§å®¹ï¼‰",
        "info": "ğŸ“˜ æ§åˆ¶æŒ‡ä»¤åˆ—è¡¨ï¼ˆå®Œæ•´æ•´ç†ç‰ˆï¼‰\n\nã€åŸºæœ¬æŒ‡ä»¤ã€‘\nHELP / H / ?\nï¼ é¡¯ç¤ºå…¨éƒ¨æ§åˆ¶æŒ‡ä»¤ã€‚\n\nã€é›»æºæ§åˆ¶ã€‘\nPWR S/0/1\nSï¼é¡¯ç¤ºç‹€æ…‹\n0ï¼é—œé–‰\n1ï¼é–‹å•Ÿ\n\nã€è¼¸å…¥ä¾†æºé¸æ“‡ã€‘\nSOURCE S/0~5\nSï¼é¡¯ç¤ºç‹€æ…‹\n0ï¼HDMI 1\n1ï¼HDMI 2\n2ï¼å…‰çº–ï¼ˆOpticalï¼‰\n3ï¼åŒè»¸ï¼ˆCoaxialï¼‰\n4ï¼LINE IN\n5ï¼RCA IN\n\nã€éŸ³é‡æ§åˆ¶ã€‘\nVOL S/0~-80\nSï¼é¡¯ç¤ºéŸ³é‡\n+ ï¼ +0.5 dB\n++ ï¼ +2 dB\n- ï¼ -0.5 dB\n-- ï¼ -2 dB\nä¹Ÿå¯è¼¸å…¥ 0 ~ -80 dB\n\nMUTE S/0/1\nSï¼é¡¯ç¤ºç‹€æ…‹\n0ï¼å–æ¶ˆéœéŸ³\n1ï¼éœéŸ³\n\nã€éº¥å…‹é¢¨æ§åˆ¶ã€‘\nMICVOL S/0~30\nSï¼é¡¯ç¤ºéŸ³é‡\n+ ï¼ +0.5 dB\n- ï¼ -0.5 dB\nä¹Ÿå¯è¼¸å…¥ 0 ~ 30\n\nMICMODE S/0~3\nSï¼é¡¯ç¤ºç‹€æ…‹\n0ï¼é—œé–‰\n1ï¼æ™®é€šæ¨¡å¼\n2ï¼Phantom æ¨¡å¼\n3ï¼Line æ¨¡å¼\n\nã€ç³»çµ±æ“ä½œã€‘\nFADEFAULT ï¼ æ¢å¾©å‡ºå» é è¨­\nREBOOT ï¼ é‡å•Ÿ\n\nã€ç¶²è·¯è³‡è¨Šã€‘\nIPCONFIG ï¼ é¡¯ç¤º IP\nRESETIP ï¼ æ¢å¾©å‡ºå»  IP\nSHOWMAC ï¼ é¡¯ç¤º MAC\nSHOWTPORT ï¼ é¡¯ç¤º Telnet Port\nSHOWHPORT ï¼ é¡¯ç¤º HTTP Port\n\nã€ç¶²è·¯è¨­å®šã€‘\nSIPADD ï¼ è¨­å®š IP\nSNETMASK ï¼ è¨­å®šç¶²è·¯é®ç½©\nSGATEWAY ï¼ è¨­å®šé–˜é“\nSHTTPPORT ï¼ è¨­å®š HTTP Portï¼ˆ1~62235ï¼Œé è¨­ 80ï¼‰\nSTELNETPPORT ï¼ è¨­å®š Telnet Portï¼ˆ1~62235ï¼Œé è¨­ 23ï¼‰\n",
        "x": 190,
        "y": 1360,
        "wires": []
    },
    {
        "id": "1273d1fbafa6d412",
        "type": "mqtt in",
        "z": "79859e535099be0e",
        "d": true,
        "g": "fee287b36585eb62",
        "name": "",
        "topic": "homeassistant/button/amp",
        "qos": "0",
        "datatype": "auto-detect",
        "broker": "751ec40a6956d4f9",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 190,
        "y": 1400,
        "wires": [
            [
                "9d3806398603dd04"
            ]
        ]
    },
    {
        "id": "e6903d63903c0a07",
        "type": "debug",
        "z": "79859e535099be0e",
        "d": true,
        "g": "fee287b36585eb62",
        "name": "å›æ‡‰",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 935,
        "y": 1400,
        "wires": [],
        "l": false
    },
    {
        "id": "998e11759241cfbf",
        "type": "inject",
        "z": "79859e535099be0e",
        "d": true,
        "g": "fee287b36585eb62",
        "name": "æ‰‹å‹•æ¸¬è©¦",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "VOL +\\r",
        "payloadType": "str",
        "x": 380,
        "y": 1440,
        "wires": [
            [
                "5a5102c1e8dd881f"
            ]
        ]
    },
    {
        "id": "119c643c2ba030ad",
        "type": "mqtt in",
        "z": "79859e535099be0e",
        "d": true,
        "g": "ab24a48df3037b0c",
        "name": "",
        "topic": "cdps/command",
        "qos": "0",
        "datatype": "auto-detect",
        "broker": "751ec40a6956d4f9",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 160,
        "y": 1600,
        "wires": [
            [
                "5cdee3ffc6572075"
            ]
        ]
    },
    {
        "id": "757c05927dbf6685",
        "type": "comment",
        "z": "79859e535099be0e",
        "d": true,
        "g": "ab24a48df3037b0c",
        "name": "ï¼´ï¼¶ç‰†æ§åˆ¶ï¼ˆé»é–‹å…§å®¹ï¼‰",
        "info": "20251119\nCDPS-CS11\nIPï¼š192.168.1.224\næ§åˆ¶åŸ ï¼šTCP 23\næŒ‡ä»¤çµå°¾\\x0d\\x0a\n\n\nset out A route 1~4\nè¨Šæº1~4åˆ‡æ›\n\nset power ON/OFF\né›»æºé–‹é—œ",
        "x": 190,
        "y": 1560,
        "wires": []
    },
    {
        "id": "0f430bed7eeddeec",
        "type": "debug",
        "z": "79859e535099be0e",
        "d": true,
        "g": "ab24a48df3037b0c",
        "name": "å›æ‡‰",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 785,
        "y": 1600,
        "wires": [],
        "l": false
    },
    {
        "id": "4dfee758a3812ea5",
        "type": "function",
        "z": "79859e535099be0e",
        "g": "7e671b9dfb6035e0",
        "name": "command(single)new",
        "func": "/**\n * å–®è‰²æº«ï¼ˆsingleï¼‰æ§åˆ¶ï¼šç”¢ç”Ÿ Modbus æŒ‡ä»¤ï¼ˆä¸å« CRCï¼‰\n * æ”¯æ´ payload = { \"state\": \"ON\" | \"OFF\", \"brightness\": number }\n *\n * è¼¸å‡ºï¼š\n *   msg.payload = Buffer (ä¸å« CRC çš„ Modbus æŒ‡ä»¤)\n *\n * ä½¿ç”¨æ–¹å¼ï¼š\n *   è«‹ä¸²æ¥ crc_builder ç¯€é»è™•ç† CRC\n */\n\nconst DEFAULT_BRIGHTNESS = 100;\nconst BRIGHTNESS_TIME = 0x05;\n\nconst CHANNEL_REGISTER_MAP = {\n    \"1\": 0x082A,\n    \"2\": 0x082B,\n    \"3\": 0x082C,\n    \"4\": 0x082D\n};\n\n// ...existing code...\n\n/* ========================== ä¸»æµç¨‹ =========================== */\nconst topic = String(msg.topic || \"\");\nconst parts = topic.split(\"/\");\n\nif (parts.length !== 6) return null;\nif (parts[0] !== \"homeassistant\") return null;\nif (parts[1] !== \"light\") return null;\nif (parts[2] !== \"single\") return null;\nif (parts[5] !== \"set\") return null;\n\nconst slaveId = Number(parts[3]);\nconst channel = parts[4];\n\nif (!Number.isInteger(slaveId) || slaveId <= 0) return null;\nconst reg = CHANNEL_REGISTER_MAP[channel];\nif (!reg) return null;\n\n/* ------------------------ è§£æ payload ------------------------ */\nlet isOn = false;\nlet brightnessFromPayload = null;\n\nif (typeof msg.payload === \"object\" && msg.payload !== null) {\n    // JSON æ ¼å¼ {\"state\":\"ON\",\"brightness\":112}\n    if (typeof msg.payload.state === \"string\") {\n        isOn = (msg.payload.state.toUpperCase() === \"ON\");\n    }\n    if (typeof msg.payload.brightness === \"number\") {\n        brightnessFromPayload = msg.payload.brightness;\n    }\n} else if (typeof msg.payload === \"string\") {\n    isOn = (msg.payload.toUpperCase() === \"ON\");\n} else if (typeof msg.payload === \"boolean\") {\n    isOn = msg.payload;\n}\n\n/* ------------------------ äº®åº¦è™•ç† ------------------------ */\nconst brightnessKey = `single_${slaveId}_${channel}_brightness`;\nlet useBrightness = null;\n\n// payload æœ‰ brightness â†’ ç”¨ payload åŒæ™‚æ›´æ–°å¿«å–\nif (typeof brightnessFromPayload === \"number\") {\n    useBrightness = Math.round(brightnessFromPayload);\n    flow.set(brightnessKey, useBrightness);\n\n    // å¦å‰‡ç”¨å¿«å–\n} else {\n    useBrightness = flow.get(brightnessKey);\n    if (typeof useBrightness !== \"number\") {\n        useBrightness = DEFAULT_BRIGHTNESS;\n    }\n}\n\n// ç¯„åœä¿è­· 0~100\nuseBrightness = Math.min(100, Math.max(0, useBrightness));\n\n// OFF = 0ã€ON = äº®åº¦\nconst value = isOn ? useBrightness : 0x00;\n\n/* ------------------------ çµ„ Modbus æŒ‡ä»¤ ------------------------ */\nconst hi = (reg >> 8) & 0xFF;\nconst lo = reg & 0xFF;\n\nconst cmd = Buffer.from([\n    slaveId,\n    0x06,\n    hi,\n    lo,\n    BRIGHTNESS_TIME,\n    value\n]);\n\n// åªè¼¸å‡ºä¸å« CRC çš„ Modbus æŒ‡ä»¤\nmsg.payload = cmd;\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 440,
        "y": 460,
        "wires": [
            [
                "2e1a783c450d4d9e"
            ]
        ]
    },
    {
        "id": "2442530f4e5ca97f",
        "type": "debug",
        "z": "79859e535099be0e",
        "g": "c0fa48505f5c7846",
        "name": "debug 1",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 3060,
        "y": 1040,
        "wires": []
    },
    {
        "id": "f6bf1604e7eae94d",
        "type": "function",
        "z": "79859e535099be0e",
        "g": "3a585159d7619ee6",
        "name": "Discovery lights MQTT",
        "func": "let devices = msg.devices || [];\n\nconst LIGHT_TYPE_MAPPING = {\n    single: {\n        brightness: true,\n        brightness_scale: 100,\n        getExtra: (path) => ({\n            brightness_state_topic: `homeassistant/light/${path}/brightness`,\n            brightness_command_topic: `homeassistant/light/${path}/set/brightness`\n        })\n    },\n    dual: {\n        brightness: true,\n        brightness_scale: 100,\n        min_mireds: 154,\n        max_mireds: 370,\n        getExtra: (path) => ({\n            brightness_state_topic: `homeassistant/light/${path}/brightness`,\n            brightness_command_topic: `homeassistant/light/${path}/set/brightness`,\n            color_temp_state_topic: `homeassistant/light/${path}/colortemp`,\n            color_temp_command_topic: `homeassistant/light/${path}/set/colortemp`\n        })\n    },\n    wrgb: {\n        brightness: true,\n        brightness_scale: 100,\n        rgb: true,\n        getExtra: (path) => ({\n            brightness_state_topic: `homeassistant/light/${path}/brightness`,\n            brightness_command_topic: `homeassistant/light/${path}/set/brightness`,\n            rgb_state_topic: `homeassistant/light/${path}/rgb`,\n            rgb_command_topic: `homeassistant/light/${path}/set/rgb`\n        })\n    },\n    rgb: {\n        brightness: true,\n        brightness_scale: 100,\n        rgb: true,\n        getExtra: (path) => ({\n            brightness_state_topic: `homeassistant/light/${path}/brightness`,\n            brightness_command_topic: `homeassistant/light/${path}/set/brightness`,\n            rgb_state_topic: `homeassistant/light/${path}/rgb`,\n            rgb_command_topic: `homeassistant/light/${path}/set/rgb`\n        })\n    }\n};\n\nlet msgs;\n\nif (msg.action === \"clear\") {\n    // å¼·åˆ¶å…¨éƒ¨æ¸…é™¤\n    msgs = devices.map(dev => {\n        let path = `${dev.type}/${dev.module_id}/${dev.channel}`;\n        let uid = path.replaceAll(\"/\", \"_\");\n        return {\n            topic: `homeassistant/light/${uid}/config`,\n            payload: \"\",\n            retain: false,\n        };\n    });\n} else if (msg.action === \"add\") {\n    // åŸæœ¬ add çš„æµç¨‹\n    msgs = devices.map(dev => {\n        let path = `${dev.type}/${dev.module_id}/${dev.channel}`;\n        let uid = path.replaceAll(\"/\", \"_\");\n        let topic = `homeassistant/light/${uid}/config`;\n        let typeConfig = LIGHT_TYPE_MAPPING[dev.type] || {};\n        let basePayload = Object.assign({\n            name: dev.name,\n            unique_id: uid,\n            object_id: uid,\n            payload_on: \"ON\",\n            payload_off: \"OFF\",\n            optimistic: true,\n            state_topic: `homeassistant/light/${path}/state`,\n            command_topic: `homeassistant/light/${path}/set`\n        }, typeConfig, typeConfig.getExtra ? typeConfig.getExtra(path) : {});\n        delete basePayload.getExtra;\n        return {\n            topic,\n            payload: JSON.stringify(basePayload),\n            retain: false\n        };\n    });\n}\n\nreturn [msgs];\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 500,
        "y": 80,
        "wires": [
            [
                "1cc00f3c0b2cb7f2"
            ]
        ]
    },
    {
        "id": "efd311ccaaf04dde",
        "type": "debug",
        "z": "79859e535099be0e",
        "d": true,
        "g": "cb7ac42eb2b47bae",
        "name": "debug 3",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 540,
        "y": 1000,
        "wires": []
    },
    {
        "id": "9d3806398603dd04",
        "type": "function",
        "z": "79859e535099be0e",
        "d": true,
        "g": "fee287b36585eb62",
        "name": "command",
        "func": "msg.payload = `${msg.payload}\\r\\n`;\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 400,
        "y": 1400,
        "wires": [
            [
                "15b05e2bb89e72e6",
                "5a5102c1e8dd881f"
            ]
        ]
    },
    {
        "id": "15b05e2bb89e72e6",
        "type": "debug",
        "z": "79859e535099be0e",
        "d": true,
        "g": "fee287b36585eb62",
        "name": "debug 4",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 400,
        "y": 1360,
        "wires": []
    },
    {
        "id": "5cdee3ffc6572075",
        "type": "function",
        "z": "79859e535099be0e",
        "d": true,
        "g": "ab24a48df3037b0c",
        "name": "command",
        "func": "msg.payload = `${msg.payload}\\r\\n`;\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 340,
        "y": 1600,
        "wires": [
            [
                "04eb16dbcb17fb36"
            ]
        ]
    },
    {
        "id": "49d0d52e18175e9f",
        "type": "function",
        "z": "79859e535099be0e",
        "g": "3a585159d7619ee6",
        "name": "discovery cover MQTT",
        "func": "// çª—ç°¾/æ²ç°¾è¨­å‚™é…ç½®ç”Ÿæˆå™¨\n// æ”¯æ´: çª—ç°¾(curtain), æ²ç°¾, æ’ç…™çª—\n\n// ============ çª—ç°¾è¨­å‚™å®šç¾© ============\nlet covers = [\n    { path: \"curtain/21/1-2-3\", name: \"éµæ²é–€\" },\n    { path: \"curtain/22/1-2\", name: \"æœƒè­°å®¤æ²ç°¾\" },\n    { path: \"curtain/23/1-2\", name: \"å¸ƒç°¾\" },\n    { path: \"curtain/23/3-4\", name: \"æ²™ç°¾\" },\n    { path: \"curtain/23/5-6-7\", name: \"æ’ç…™çª—\" },\n];\n\n\n// ============ è¨»å†Š/æ¸…é™¤é‚è¼¯ ============\nlet msgs;\n\nif (msg.action === \"clear\") {\n    // å¼·åˆ¶å…¨éƒ¨æ¸…é™¤\n    msgs = covers.map(cover => {\n        let uid = cover.path.replace(/\\//g, \"_\");\n        return {\n            topic: `homeassistant/cover/${uid}/config`,\n            payload: \"\",\n            retain: false\n        };\n    });\n} else if (msg.action === \"add\") {\n    // æ–°å¢è¨»å†Š\n    msgs = covers.map(cover => {\n        let uid = cover.path.replace(/\\//g, \"_\");\n        let part = cover.path.split(\"/\");\n        let device_type = part[0];\n        let id = part[1];\n        let control = (part[2]).split(\"-\");\n\n        let basePayload = {\n            name: cover.name,\n            unique_id: uid,\n            optimistic: true,\n            retain: false\n        };\n\n        let operation_type;\n        switch (control.length) {\n            case 2: {\n                operation_type = \"oc\";\n                basePayload.payload_open = `${control[0]}/${control[1]}`;\n                basePayload.payload_close = `${control[1]}/${control[0]}`;\n                basePayload.payload_stop = `${control[0]}_${control[1]}/`;\n                break;\n            }\n            case 3: {\n                operation_type = \"ocs\";\n                basePayload.payload_open = `${control[0]}/${control[1]}_${control[2]}`;\n                basePayload.payload_close = `${control[1]}/${control[0]}_${control[2]}`;\n                basePayload.payload_stop = `${control[2]}/${control[0]}_${control[1]}`;\n                break;\n            }\n            default: {\n                node.warn(\"Unknown type of curtain\");\n                break;\n            }\n        }\n\n        basePayload.command_topic = `homeassistant/cover/${device_type}/${id}/${operation_type}/set`;\n        basePayload.state_topic = `homeassistant/cover/${device_type}/${id}/${operation_type}/state`;\n\n        return {\n            topic: `homeassistant/cover/${uid}/config`,\n            payload: JSON.stringify(basePayload),\n        };\n    });\n}\n\nreturn [msgs];\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 380,
        "y": 240,
        "wires": [
            [
                "78f4728893f104ea"
            ]
        ]
    },
    {
        "id": "78f4728893f104ea",
        "type": "mqtt out",
        "z": "79859e535099be0e",
        "g": "3a585159d7619ee6",
        "name": "ç™¼é€åˆ° MQTT Broker",
        "topic": "",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "751ec40a6956d4f9",
        "x": 640,
        "y": 240,
        "wires": []
    },
    {
        "id": "f0a53827097b2671",
        "type": "inject",
        "z": "79859e535099be0e",
        "g": "3a585159d7619ee6",
        "name": "åŠ å…¥ Discovery",
        "props": [
            {
                "p": "action",
                "v": "add",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 160,
        "y": 220,
        "wires": [
            [
                "49d0d52e18175e9f"
            ]
        ]
    },
    {
        "id": "2ceea1da7a9b4c81",
        "type": "inject",
        "z": "79859e535099be0e",
        "g": "3a585159d7619ee6",
        "name": "æ¸…é™¤ Discovery",
        "props": [
            {
                "p": "action",
                "v": "clear",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 160,
        "y": 260,
        "wires": [
            [
                "49d0d52e18175e9f"
            ]
        ]
    },
    {
        "id": "06b95753cb12b3eb",
        "type": "tcp request",
        "z": "79859e535099be0e",
        "d": true,
        "g": "77b1f027c533026f",
        "name": "",
        "server": "192.168.1.208",
        "port": "502",
        "out": "time",
        "ret": "buffer",
        "splitc": "0",
        "newline": "",
        "trim": false,
        "tls": "",
        "x": 920,
        "y": 1220,
        "wires": [
            [
                "dacef01f5e9cce9f"
            ]
        ]
    },
    {
        "id": "c96820edd7b7eb09",
        "type": "tcp request",
        "z": "79859e535099be0e",
        "d": true,
        "g": "77b1f027c533026f",
        "name": "",
        "server": "192.168.1.204",
        "port": "502",
        "out": "time",
        "ret": "buffer",
        "splitc": "0",
        "newline": "",
        "trim": false,
        "tls": "",
        "x": 920,
        "y": 1260,
        "wires": [
            [
                "dacef01f5e9cce9f"
            ]
        ]
    },
    {
        "id": "a94012a54dfce52e",
        "type": "tcp request",
        "z": "79859e535099be0e",
        "d": true,
        "g": "fee287b36585eb62",
        "name": "",
        "server": "192.168.1.208",
        "port": "502",
        "out": "time",
        "ret": "buffer",
        "splitc": "0",
        "newline": "",
        "trim": false,
        "tls": "",
        "x": 740,
        "y": 1380,
        "wires": [
            [
                "071cc0948a816526"
            ]
        ]
    },
    {
        "id": "dcdc489e0899a97d",
        "type": "tcp request",
        "z": "79859e535099be0e",
        "d": true,
        "g": "fee287b36585eb62",
        "name": "",
        "server": "192.168.1.204",
        "port": "502",
        "out": "time",
        "ret": "buffer",
        "splitc": "0",
        "newline": "",
        "trim": false,
        "tls": "",
        "x": 740,
        "y": 1420,
        "wires": [
            [
                "071cc0948a816526"
            ]
        ]
    },
    {
        "id": "42aa1110d8a20ee4",
        "type": "tcp request",
        "z": "79859e535099be0e",
        "d": true,
        "g": "ab24a48df3037b0c",
        "name": "",
        "server": "192.168.1.208",
        "port": "502",
        "out": "time",
        "ret": "buffer",
        "splitc": "0",
        "newline": "",
        "trim": false,
        "tls": "",
        "x": 580,
        "y": 1580,
        "wires": [
            [
                "475bf3086146b723"
            ]
        ]
    },
    {
        "id": "a8ac8c92efdfdb18",
        "type": "tcp request",
        "z": "79859e535099be0e",
        "d": true,
        "g": "ab24a48df3037b0c",
        "name": "",
        "server": "192.168.1.204",
        "port": "502",
        "out": "time",
        "ret": "buffer",
        "splitc": "0",
        "newline": "",
        "trim": false,
        "tls": "",
        "x": 580,
        "y": 1620,
        "wires": [
            [
                "475bf3086146b723"
            ]
        ]
    },
    {
        "id": "170d3db142080853",
        "type": "tcp request",
        "z": "79859e535099be0e",
        "g": "d56a6d6541454cc1",
        "name": "",
        "server": "192.168.1.204",
        "port": "502",
        "out": "time",
        "ret": "buffer",
        "splitc": "0",
        "newline": "",
        "trim": false,
        "tls": "",
        "x": 2000,
        "y": 900,
        "wires": [
            [
                "573bdd7cc8dc6707"
            ]
        ]
    },
    {
        "id": "061a3cf0fdc32f02",
        "type": "mqtt in",
        "z": "79859e535099be0e",
        "g": "b662aa09fba3884d",
        "name": "",
        "topic": "homeassistant/hvac/hitachi/+/+/mode/set",
        "qos": "0",
        "datatype": "auto-detect",
        "broker": "751ec40a6956d4f9",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 115,
        "y": 840,
        "wires": [
            [
                "1c5a90ffab54229c"
            ]
        ],
        "l": false
    },
    {
        "id": "9e48970838d91a36",
        "type": "mqtt in",
        "z": "79859e535099be0e",
        "g": "b662aa09fba3884d",
        "name": "",
        "topic": "homeassistant/hvac/hitachi/+/+/temperature/set",
        "qos": "0",
        "datatype": "auto-detect",
        "broker": "751ec40a6956d4f9",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 75,
        "y": 860,
        "wires": [
            [
                "1c5a90ffab54229c"
            ]
        ],
        "l": false
    },
    {
        "id": "6d20207c06b7aa83",
        "type": "mqtt out",
        "z": "79859e535099be0e",
        "g": "b662aa09fba3884d",
        "name": "homeassistant/hvac/i2/+/+/mode/state",
        "topic": "",
        "qos": "1",
        "retain": "false",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "751ec40a6956d4f9",
        "x": 375,
        "y": 860,
        "wires": [],
        "l": false
    },
    {
        "id": "27a7dd6e9d9fdae8",
        "type": "debug",
        "z": "79859e535099be0e",
        "g": "b662aa09fba3884d",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 405,
        "y": 860,
        "wires": [],
        "l": false
    },
    {
        "id": "72010986a865dacb",
        "type": "mqtt in",
        "z": "79859e535099be0e",
        "g": "af19c60e6b32205e",
        "name": "",
        "topic": "homeassistant/light/dual/+/+/set",
        "qos": "0",
        "datatype": "auto-detect",
        "broker": "751ec40a6956d4f9",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 190,
        "y": 560,
        "wires": [
            [
                "502e5684346e25d1"
            ]
        ]
    },
    {
        "id": "502e5684346e25d1",
        "type": "function",
        "z": "79859e535099be0e",
        "g": "af19c60e6b32205e",
        "name": "command(dual)new",
        "func": "/**\n * é›™è‰²æº«ï¼ˆdualï¼‰æ§åˆ¶ï¼šç”¢ç”Ÿå…©ç­† Modbus æŒ‡ä»¤ï¼ˆä¸å« CRCï¼‰\n * Topic: homeassistant/light/dual/{id}/{channel}/set\n * Payload: \"ON\" | \"OFF\" | boolean | number\n *\n * æŒ‡ä»¤æ ¼å¼ï¼š\n * [SLAVE_ID, 0x06, REG_HI, REG_LO, DIMMING_SPEED, VALUE]\n *\n * é€šé“å¯„å­˜å™¨ï¼š\n * a â†’ 2090 (0x082A, äº®åº¦), 2091 (0x082B, è‰²æº«)\n * b â†’ 2092 (0x082C, äº®åº¦), 2093 (0x082D, è‰²æº«)\n *\n * è¼¸å‡ºï¼š\n *   msg.payload = Buffer (ä¸å« CRC çš„ Modbus æŒ‡ä»¤)\n *\n * ä½¿ç”¨æ–¹å¼ï¼š\n *   è«‹ä¸²æ¥ crc_builder ç¯€é»è™•ç† CRC\n */\n\nconst DEFAULT_BRIGHTNESS = 100; // 0~100\nconst DEFAULT_COLORTEMP = 250; // mired (â‰ˆ4000K)\nconst MIN_MIRED = 167, MAX_MIRED = 333;\nconst DIMMING_SPEED = 0x05;\n\nconst CHANNEL_REGISTER_MAP = {\n    \"a\": [0x082A, 0x082B], // brightness, colortemp\n    \"b\": [0x082C, 0x082D]\n};\n\n// å»ºç«‹å–®ç­† 0x06 æŒ‡ä»¤ï¼ˆä¸å« CRCï¼‰\nfunction buildCommand(id, reg, value) {\n    const hi = (reg >> 8) & 0xFF;\n    const lo = reg & 0xFF;\n    return Buffer.from([id, 0x06, hi, lo, DIMMING_SPEED, value]);\n}\n\n// ===================== ä¸»æµç¨‹ =====================\nconst parts = String(msg.topic || \"\").split(\"/\");\nif (parts.length < 6 || parts[2] !== \"dual\" || parts[5] !== \"set\") return null;\n\nconst slaveId = parseInt(parts[3]) || 0;\nconst chStr = (parts[4] || \"\").toLowerCase();\nconst regs = CHANNEL_REGISTER_MAP[chStr];\nif (!regs) return null;\n\n// ç‹€æ…‹åˆ¤æ–·\nlet state = \"OFF\";\nif (msg.payload === \"ON\") state = \"ON\";\n\n// è®€å–å¿«å–\nconst brKey = `dual_${slaveId}_${chStr}_brightness`;\nconst ctKey = `dual_${slaveId}_${chStr}_colortemp`;\n\nlet brightness = flow.get(brKey);\nif (typeof brightness !== \"number\") brightness = DEFAULT_BRIGHTNESS;\nbrightness = Math.max(0, Math.min(100, Math.round(brightness)));\n\nlet colortemp = flow.get(ctKey);\nif (typeof colortemp !== \"number\") colortemp = DEFAULT_COLORTEMP;\ncolortemp = Math.max(MIN_MIRED, Math.min(MAX_MIRED, Math.round(colortemp)));\n\n// OFF = äº®åº¦æ­¸ 0\nconst brValue = (state === \"ON\") ? brightness : 0;\n\n// è‰²æº«è½‰æ› (mired â†’ 0~100)\nconst ctPercent = Math.round(((MAX_MIRED - colortemp) / (MAX_MIRED - MIN_MIRED)) * 100);\n\n// ç”¢ç”Ÿå…©ç­†æŒ‡ä»¤ï¼ˆä¸å« CRCï¼‰\nconst cmdBrightness = buildCommand(slaveId, regs[0], brValue);\nconst cmdColortemp = buildCommand(slaveId, regs[1], ctPercent);\n\nnode.send({ payload: cmdBrightness });\nnode.send({ payload: cmdColortemp });\n\nreturn null;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 450,
        "y": 560,
        "wires": [
            [
                "2e1a783c450d4d9e"
            ]
        ]
    },
    {
        "id": "60674ad3db7eaaf9",
        "type": "function",
        "z": "79859e535099be0e",
        "g": "c0fa48505f5c7846",
        "name": "è§£æå›æ‡‰(æ—¥ç«‹å†·æ°£)",
        "func": "// HVAC Feedback è§£æå™¨ï¼ˆç¨ç«‹ç‰ˆï¼Œç¬¦åˆ discovery_climate_MQTT.js çš„ topic è¦å‰‡ï¼‰\n// è¼¸å…¥ï¼šmsg.payload = Buffer (17 bytes, å·²é©—è­‰ CRC)\n// è¼¸å‡ºï¼šMQTT ç‹€æ…‹é™£åˆ— [{ topic, payload }...]\n\n// === ç‹€æ…‹å°æ‡‰è¡¨ ===\nconst HVAC_MODE_MAP = {\n    0: \"cool\",\n    1: \"heat\",\n    2: \"dry\",\n    3: \"fan_only\",\n    4: \"off\"\n};\nconst HVAC_FAN_MAP = {\n    0: \"auto\",\n    1: \"low\",\n    2: \"medium\",\n    3: \"high\"\n};\n\n// === è§£æä¸»ç¨‹å¼ ===\nconst buf = msg.payload;\nif (!Buffer.isBuffer(buf) || buf.length !== 17) return null;\n\nconst moduleId = buf[0];\nconst funcCode = buf[1];\nif (funcCode !== 0x03) return null;\n\nconst power_state = buf.readUInt16BE(3);\nconst mode_state = buf.readUInt16BE(5);\nconst fan_mode_state = buf.readUInt16BE(7);\nconst temperature_state = buf.readUInt16BE(9);\nconst current_temperature_state = buf.readUInt16BE(11);\nconst hvac_id = buf.readUInt8(14) / 8;\n\n// topic path: homeassistant/hvac/<brand>/<moduleId>/<hvac_id>\nconst brand = \"hitachi\"; // ä¾ discovery_climate_MQTT.js\nconst baseTopic = `homeassistant/hvac/${brand}/${moduleId}/${hvac_id}`;\n\nconst mode_state_str = (power_state === 0) ? \"off\" : (HVAC_MODE_MAP[mode_state] || \"off\");\nconst fan_mode_state_str = HVAC_FAN_MAP[fan_mode_state] || \"auto\";\n\nlet mqttMessages = [];\nmqttMessages.push({ topic: `${baseTopic}/mode/state`, payload: mode_state_str });\nmqttMessages.push({ topic: `${baseTopic}/fan/state`, payload: fan_mode_state_str });\nmqttMessages.push({ topic: `${baseTopic}/temperature/state`, payload: temperature_state });\nmqttMessages.push({ topic: `${baseTopic}/current_temperature`, payload: current_temperature_state });\n\nreturn [mqttMessages];\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2730,
        "y": 940,
        "wires": [
            [
                "23bf88cce761058f"
            ]
        ]
    },
    {
        "id": "6de84d0186481cfd",
        "type": "function",
        "z": "79859e535099be0e",
        "g": "c0fa48505f5c7846",
        "name": "CRC é©—è­‰",
        "func": "// Node-RED Function ç¯€é»ï¼šCRC16 é©—è­‰éæ¿¾å™¨\n// è¼¸å…¥ï¼šmsg.payload = Buffer\n// é€šéé©—è­‰æ‰å¾€ä¸‹å‚³éï¼Œä¸é€šéå‰‡ä¸å‚³é\n\nfunction crc16(buf) {\n    let crc = 0xFFFF;\n    for (const b of buf) {\n        crc ^= b;\n        for (let i = 0; i < 8; i++) {\n            crc = (crc & 1) ? ((crc >> 1) ^ 0xA001) : (crc >> 1);\n        }\n    }\n    return crc;\n}\n\nfunction verifyCRC(buf) {\n    let crc = 0xFFFF;\n    for (let i = 0; i < buf.length - 2; i++) {\n        crc ^= buf[i];\n        for (let j = 0; j < 8; j++) {\n            crc = (crc & 1) ? ((crc >> 1) ^ 0xA001) : (crc >> 1);\n        }\n    }\n    const crcLow = crc & 0xFF;\n    const crcHigh = (crc >> 8) & 0xFF;\n    return (crcLow === buf[buf.length - 2]) && (crcHigh === buf[buf.length - 1]);\n}\n\nif (Buffer.isBuffer(msg.payload) && verifyCRC(msg.payload)) {\n    return msg;\n} else {\n    // é©—è­‰å¤±æ•—ä¸å¾€ä¸‹å‚³\n    return null;\n}\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2560,
        "y": 940,
        "wires": [
            [
                "60674ad3db7eaaf9"
            ]
        ]
    },
    {
        "id": "86fc96d6f1ab87c8",
        "type": "function",
        "z": "79859e535099be0e",
        "g": "c0fa48505f5c7846",
        "name": "è§£æå›æ‡‰(R410)",
        "func": "/**\n * Relay ç‹€æ…‹è§£æï¼ˆåƒ… Relayï¼‰\n * æ”¯æ´å›æ‡‰ï¼šModbus RTU 0x01 Read Coils\n *\n * å›æ‡‰æ ¼å¼ï¼š\n * [SLAVE_ID][0x01][BYTE_COUNT][DATA0][DATA1]...[CRC_L][CRC_H]\n * å…¶ä¸­ DATA çš„ bit0~bit3 å°æ‡‰é€šé“ 1~4\n *\n * è¼¸å‡º MQTTï¼š\n *   homeassistant/light/relay/{id}/{channel}/state\n *   payload: \"ON\" | \"OFF\"\n *\n * === å¦‚ä½•å¢åŠ é€šé“æ•¸é‡ ===\n * 1. ä¿®æ”¹ for è¿´åœˆä¸Šé™ (é è¨­ 4)\n *      for (let ch = 0; ch < 8; ch++) { ... }   // 8 é€šé“\n * 2. æ¯å¢åŠ  8 å€‹é€šé“ï¼Œæœƒå¤šç”¨åˆ° 1 å€‹ data byte\n *      ä¾‹å¦‚ 16 é€šé“ â†’ buffer[3], buffer[4] å…©å€‹ byte\n *      ä¾‹å¦‚ 24 é€šé“ â†’ buffer[3], buffer[4], buffer[5]\n * 3. ä¸éœ€æ”¹å…¶ä»–ç¨‹å¼ï¼Œå› ç‚ºä½å…ƒè§£æé‚è¼¯å·²ç¶“è™•ç†ã€Œè·¨ byteã€æƒ…æ³\n */\n\n// ---- CRC é©—è­‰ ----\nfunction verifyCRC(buf) {\n    let crc = 0xFFFF;\n    for (let i = 0; i < buf.length - 2; i++) {\n        crc ^= buf[i];\n        for (let j = 0; j < 8; j++) {\n            crc = (crc & 1) ? ((crc >> 1) ^ 0xA001) : (crc >> 1);\n        }\n    }\n    const lo = crc & 0xFF;\n    const hi = (crc >> 8) & 0xFF;\n    return lo === buf[buf.length - 2] && hi === buf[buf.length - 1];\n}\n\n// ---- ä¸»æµç¨‹ ----\nconst buf = msg.payload;\nif (!Buffer.isBuffer(buf)) return null;\nif (buf.length < 5) return null;\n\nconst id = buf[0];\nconst funcCode = buf[1];\nconst byteCnt = buf[2];\n\n// æª¢æŸ¥åŠŸèƒ½ç¢¼èˆ‡é•·åº¦\nif (funcCode !== 0x01) return null;\nif (buf.length !== 3 + byteCnt + 2) return null;\nif (!verifyCRC(buf)) return null;\n\nconst mqttMsgs = [];\n\n// === è§£æ Relay ç‹€æ…‹ ===\n// é è¨­è§£æå‰ 4 å€‹ Relay (bit0~bit3)\n// âœ å¦‚æœè¦å¢åŠ é€šé“æ•¸é‡ï¼Œä¿®æ”¹ for è¿´åœˆä¸Šé™å³å¯\nfor (let ch = 0; ch < 4; ch++) {\n    // æ¯ 8 å€‹é€šé“ä½¿ç”¨ 1 å€‹ data byte\n    const byteIndex = 3 + Math.floor(ch / 8);\n    const bitIndex = ch % 8;\n    const state = ((buf[byteIndex] >> bitIndex) & 1) ? \"ON\" : \"OFF\";\n\n    mqttMsgs.push({\n        topic: `homeassistant/light/relay/${id}/${ch + 1}/state`,\n        payload: state\n    });\n}\n\n// âœ… ä¸€æ¬¡è¼¸å‡ºå¤šç­†\nreturn [mqttMsgs];\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2720,
        "y": 1020,
        "wires": [
            [
                "23bf88cce761058f"
            ]
        ]
    },
    {
        "id": "1c5a90ffab54229c",
        "type": "function",
        "z": "79859e535099be0e",
        "g": "b662aa09fba3884d",
        "name": "å†·æ°£è™•ç†",
        "func": "/**\n * ç©ºèª¿è™•ç†å™¨ - æ”¯æ´ HVAC æ§åˆ¶ï¼ˆä¸å« CRCï¼‰\n * \n * Node Type: function\n * \n * è¼¸å‡ºï¼š\n *   Output 1: Modbus æŒ‡ä»¤ï¼ˆä¸å« CRCï¼‰â†’ è«‹ä¸²æ¥ crc_builder ç¯€é»\n *   Output 2: MQTT ç‹€æ…‹   â†’ é€£æ¥åˆ° MQTT out\n * \n * æ”¯æ´çš„ Topic æ ¼å¼:\n *   homeassistant/hvac/{s200Id}/{hvacId}/mode/set     (payload: \"cool\", \"heat\", \"dry\", \"fan_only\", \"off\")\n *   homeassistant/hvac/{s200Id}/{hvacId}/temperature/set (payload: 16-30)\n *   homeassistant/hvac/{s200Id}/{hvacId}/fan/set      (payload: \"auto\", \"low\", \"medium\", \"high\")\n */\n\n// ...existing code...\n\n// ========== å¸¸æ•¸å®šç¾© ==========\nconst MODE_MAP = {\n    \"cool\": 0,\n    \"heat\": 1,\n    \"dry\": 2,\n    \"fan_only\": 3,\n    \"off\": 4\n};\n\nconst FAN_MODE_MAP = {\n    \"auto\": 0,\n    \"low\": 1,\n    \"medium\": 2,\n    \"high\": 3\n};\n\n// ========== ä¸»è™•ç†é‚è¼¯ ==========\nconst parts = String(msg.topic || \"\").split(\"/\");\nconst deviceType = parts[1];     // hvac\nconst brand = parts[2];          // hitachi\nlet s200Id, hvacId, hvacAction;\nif (deviceType !== \"hvac\") return null;\n\nif (brand === \"hitachi\") {\n    s200Id = parseInt(parts[3]);\n    hvacId = parseInt(parts[4]);\n    hvacAction = parts[5];\n} else {\n    s200Id = parseInt(parts[2]);\n    hvacId = parseInt(parts[3]);\n    hvacAction = parts[4];\n}\nconst payload = msg.payload;\n\nconst baseAddress = 0x100;\nconst speed = 0x00;\nlet register, value;\nswitch (hvacAction) {\n    case \"mode\":\n        register = baseAddress + hvacId * 8 + 1;\n        value = MODE_MAP[payload];\n        break;\n    case \"fan\":\n        register = baseAddress + hvacId * 8 + 2;\n        value = FAN_MODE_MAP[payload];\n        break;\n    case \"temperature\":\n        register = baseAddress + hvacId * 8 + 3;\n        value = parseFloat(payload);\n        break;\n    default:\n        return null;\n}\nif (value === undefined || value === null) return null;\nconst regHi = (register >> 8) & 0xFF;\nconst regLo = register & 0xFF;\nconst cmd = Buffer.from([\n    s200Id,\n    0x06,\n    regHi,\n    regLo,\n    speed,\n    value\n]);\n// åªè¼¸å‡ºä¸å« CRC çš„ Modbus æŒ‡ä»¤\nmsg.payload = cmd;\nreturn msg;\n",
        "outputs": 2,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 280,
        "y": 860,
        "wires": [
            [
                "27a7dd6e9d9fdae8",
                "2e1a783c450d4d9e"
            ],
            [
                "6d20207c06b7aa83"
            ]
        ]
    },
    {
        "id": "489e84f129e98e9d",
        "type": "mqtt in",
        "z": "79859e535099be0e",
        "g": "b662aa09fba3884d",
        "name": "",
        "topic": "homeassistant/hvac/hitachi/+/+/fan/set",
        "qos": "0",
        "datatype": "auto-detect",
        "broker": "751ec40a6956d4f9",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 115,
        "y": 880,
        "wires": [
            [
                "1c5a90ffab54229c"
            ]
        ],
        "l": false
    },
    {
        "id": "5c535193a21eb19a",
        "type": "function",
        "z": "79859e535099be0e",
        "g": "80259d33a2320f8b",
        "name": "command(cover)new",
        "func": "/**\n * çª—ç°¾è™•ç†å™¨ - æ”¯æ´çª—ç°¾/æ²ç°¾/æ’ç…™çª—\n * \n * Node Type: function\n * \n * è¼¸å‡ºï¼š\n *   Output 1: Modbus æŒ‡ä»¤ â†’ é€£æ¥åˆ° modbus_queue.js\n *   Output 2: MQTT ç‹€æ…‹   â†’ é€£æ¥åˆ° MQTT out\n * \n * æ”¯æ´çš„ Topic æ ¼å¼:\n *   homeassistant/cover/general/{moduleId}/set\n *   payload: \"1_2/3\" è¡¨ç¤ºé–‹å•Ÿ relay 1 å’Œ 2ï¼Œé—œé–‰ relay 3\n */\n\n// CRC ç”± crc_builder.js è™•ç†\n\n// ========== ä¸»è™•ç†é‚è¼¯ ==========\nconst parts = String(msg.topic || \"\").split(\"/\");\nconst deviceType = parts[1];     // cover\nconst subType = parts[2];        // general, curtain\nconst moduleId = parseInt(parts[3]);\n\nif (deviceType !== \"cover\") {\n    return null;\n}\n\nlet modbusMessages = [];\n\n// æ ¼å¼: homeassistant/cover/general/12/set\n// payload: \"1_2/3\" è¡¨ç¤ºé–‹å•Ÿ relay 1 å’Œ 2ï¼Œé—œé–‰ relay 3\n\nconst relays = String(msg.payload).split(\"/\");\nconst on_relays = relays[0] ? relays[0].split(\"_\").map(Number).filter(n => !isNaN(n)) : [];\nconst off_relays = (relays[1] && relays[1].length > 0) ? relays[1].split(\"_\").map(Number).filter(n => !isNaN(n)) : [];\n\nlet output = 0x00;\nfor (let relay of on_relays) {\n    output |= (1 << (relay - 1));\n}\nfor (let relay of off_relays) {\n    output &= ~(1 << (relay - 1));\n}\n\nconst cmd = Buffer.from([moduleId, 0x06, 0x01, 0x9b, 0x10, output]);\n\nmodbusMessages.push({ payload: cmd, deviceType, moduleId, on_relays, off_relays });\n\nnode.status({\n    fill: \"blue\",\n    shape: \"dot\",\n    text: `Cover: ON[${on_relays}] OFF[${off_relays}]`\n});\n\nreturn [modbusMessages, []];\n",
        "outputs": 2,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 420,
        "y": 700,
        "wires": [
            [
                "6f5bfe91ac316558",
                "2e1a783c450d4d9e"
            ],
            [
                "49ddb436293a424f"
            ]
        ]
    },
    {
        "id": "9e8d59129c920643",
        "type": "mqtt in",
        "z": "79859e535099be0e",
        "g": "80259d33a2320f8b",
        "name": "",
        "topic": "homeassistant/cover/+/+/+/set",
        "qos": "0",
        "datatype": "auto-detect",
        "broker": "751ec40a6956d4f9",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 180,
        "y": 700,
        "wires": [
            [
                "5c535193a21eb19a"
            ]
        ]
    },
    {
        "id": "49ddb436293a424f",
        "type": "mqtt out",
        "z": "79859e535099be0e",
        "g": "80259d33a2320f8b",
        "name": "homeassistant/hvac/i2/+/+/mode/state",
        "topic": "",
        "qos": "1",
        "retain": "false",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "751ec40a6956d4f9",
        "x": 575,
        "y": 740,
        "wires": [],
        "l": false
    },
    {
        "id": "6f5bfe91ac316558",
        "type": "debug",
        "z": "79859e535099be0e",
        "g": "80259d33a2320f8b",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 565,
        "y": 660,
        "wires": [],
        "l": false
    },
    {
        "id": "0989d9ef2ad0970a",
        "type": "function",
        "z": "79859e535099be0e",
        "g": "c0fa48505f5c7846",
        "name": "è§£æå›æ‡‰(hmi)",
        "func": "/**\n * HMI è™•ç†å™¨ - è§¸æ§è¢å¹•æŒ‡ä»¤è§£æï¼ˆå„ªåŒ–ç‰ˆï¼‰\n */\n\nconst MODE_MAP = {\n    0x00: \"cool\",\n    0x01: \"dry\",\n    0x02: \"fan_only\",\n    0x04: \"heat\"\n};\nconst FAN_MAP = {\n    0x03: \"medium\",\n    0x04: \"high\",\n    0x05: \"auto\",\n    0x07: \"low\"\n};\n\nconst HMI_PATTERN = [\n    {\n        pattern: [0x01, 0x31, null, 0x01, 0x01, null],\n        topic: (input) => `homeassistant/hvac/hitachi/200/${input[5]}/mode/set`,\n        payload: (input) => input[2] === 0x01 ? \"cool\" : \"off\"\n    },\n    {\n        pattern: [0x01, 0x32, null, 0x01, 0x01, null],\n        topic: (input) => `homeassistant/hvac/hitachi/200/${input[5]}/temperature/set`,\n        payload: (input) => String(input[2])\n    },\n    {\n        pattern: [0x01, 0x33, null, 0x01, 0x01, null],\n        topic: (input) => `homeassistant/hvac/hitachi/200/${input[5]}/mode/set`,\n        payload: (input) => MODE_MAP[input[2]]\n    },\n    {\n        pattern: [0x01, 0x34, null, 0x01, 0x01, null],\n        topic: (input) => `homeassistant/hvac/hitachi/200/${input[5]}/fan/set`,\n        payload: (input) => FAN_MAP[input[2]]\n    }\n];\n\nfunction matchPattern(input, pattern) {\n    if (input.length < pattern.length) return false;\n    for (let i = 0; i < pattern.length; i++) {\n        if (pattern[i] !== null && pattern[i] !== input[i]) {\n            return false;\n        }\n    }\n    return true;\n}\n\nif (!msg.payload || !Buffer.isBuffer(msg.payload)) {\n    return null;\n}\n\nconst input = Array.from(msg.payload);\nfor (const p of HMI_PATTERN) {\n    if (matchPattern(input, p.pattern)) {\n        const topic = p.topic(input);\n        const payload = p.payload(input);\n        if (topic && payload !== undefined && payload !== null) {\n            return [[{ topic, payload }]];\n        }\n        break;\n    }\n}\nreturn null;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2720,
        "y": 1060,
        "wires": [
            [
                "23bf88cce761058f"
            ]
        ]
    },
    {
        "id": "d3d9561ca4f0dbd2",
        "type": "tcp in",
        "z": "79859e535099be0e",
        "g": "c0fa48505f5c7846",
        "name": "",
        "server": "client",
        "host": "192.168.1.208",
        "port": "502",
        "datamode": "stream",
        "datatype": "buffer",
        "newline": "",
        "topic": "",
        "trim": false,
        "base64": false,
        "tls": "",
        "x": 2520,
        "y": 1060,
        "wires": [
            [
                "0989d9ef2ad0970a"
            ]
        ]
    },
    {
        "id": "870d64ed9aef6fec",
        "type": "function",
        "z": "79859e535099be0e",
        "g": "0e61521047ef3674",
        "name": "modbusæŒ‡ä»¤åˆ†æµ",
        "func": "switch((msg.payload)[0]) {\n    default: return [msg, msg, null];\n}",
        "outputs": 3,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1750,
        "y": 940,
        "wires": [
            [
                "170d3db142080853"
            ],
            [
                "9b837e196b0b38cd"
            ],
            []
        ]
    },
    {
        "id": "2e1a783c450d4d9e",
        "type": "function",
        "z": "79859e535099be0e",
        "name": "CRC builder",
        "func": "/**\n * CRC16 æŒ‡ä»¤å»ºæ§‹å™¨\n * \n * Node Type: function\n * \n * è¼¸å…¥ï¼š\n *   msg.payload = Buffer (ä¸å« CRC çš„ Modbus æŒ‡ä»¤)\n * \n * è¼¸å‡ºï¼š\n *   msg.payload = Buffer (å« CRC çš„å®Œæ•´ Modbus æŒ‡ä»¤)\n * \n * ä½¿ç”¨æ–¹å¼ï¼š\n *   processor_light â†’ crc_builder â†’ modbus_queue\n */\n\nfunction crc16(buf) {\n    let crc = 0xFFFF;\n    for (const b of buf) {\n        crc ^= b;\n        for (let i = 0; i < 8; i++) {\n            crc = (crc & 1) ? ((crc >> 1) ^ 0xA001) : (crc >> 1);\n        }\n    }\n    return crc;\n}\n\n// ç¢ºä¿ payload æ˜¯ Buffer\nlet frame = msg.payload;\nif (!Buffer.isBuffer(frame)) {\n    if (Array.isArray(frame)) {\n        frame = Buffer.from(frame);\n    } else {\n        node.warn(\"è¼¸å…¥å¿…é ˆæ˜¯ Buffer æˆ– Array\");\n        return null;\n    }\n}\n\nconst crc = crc16(frame);\nmsg.payload = Buffer.concat([frame, Buffer.from([crc & 0xFF, (crc >> 8) & 0xFF])]);\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 950,
        "y": 800,
        "wires": [
            [
                "9ef757eadc58071e"
            ]
        ]
    },
    {
        "id": "8f9e900c7e09ee50",
        "type": "function",
        "z": "79859e535099be0e",
        "g": "3a585159d7619ee6",
        "name": "lights",
        "func": "/**\n * å‘½åè¦å‰‡ï¼š\n * type: singleã€dualã€wrgbã€rgbã€relay\n * module_id: Modbus Slave ID (åé€²ä½å­—ä¸²)\n * channel:\n * - single: 1ã€2ã€3...\n * - dual: aã€b\n * - wrgb/rgb: x\n * - relay: 1ã€2ã€3...\n * è¨»å†Šç¯„ä¾‹:\n * { type: \"single\", module_id: \"11\", channel: \"1\", name: \"èµ°å»Šé–“ç…§\" }\n * { type: \"dual\", module_id: \"14\", channel: \"a\", name: \"è»Œé“ç‡ˆ\" }\n * { type: \"wrgb\", module_id: \"2\", channel: \"x\", name: \"WRGBç‡ˆ-2\" }\n * { type: \"rgb\", module_id: \"11\", channel: \"x\", name: \"RGBç‡ˆ-11\" }\n * { type: \"relay\", module_id: \"21\", channel: \"1\", name: \"ç¹¼é›»å™¨-1\" }\n */\n\nmsg.devices = [\n    // ç›¤A\n    { type: \"single\", module_id: \"11\", channel: \"1\", name: \"èµ°å»Šé–“ç…§\" },\n    { type: \"single\", module_id: \"12\", channel: \"1\", name: \"æ³¡èŒ¶å€\" },\n    { type: \"single\", module_id: \"12\", channel: \"2\", name: \"èµ°é“å´ç‡ˆ/åœ°é–“ç…§\" },\n    { type: \"single\", module_id: \"12\", channel: \"3\", name: \"å±•ç¤ºæ«ƒ\" },\n    { type: \"single\", module_id: \"13\", channel: \"1\", name: \"æœƒè­°é–“ç…§\" },\n    { type: \"single\", module_id: \"13\", channel: \"2\", name: \"å†·æ°£é–“ç…§\" },\n    { type: \"single\", module_id: \"13\", channel: \"3\", name: \"æœƒè­°å´ç‡ˆ\" },\n    { type: \"dual\", module_id: \"14\", channel: \"a\", name: \"è»Œé“ç‡ˆ\" },\n    { type: \"dual\", module_id: \"14\", channel: \"b\", name: \"åŠç‡ˆ\" },\n    // ç›¤B\n    { type: \"single\", module_id: \"15\", channel: \"1\", name: \"å®¢å»³å‰\" },\n    { type: \"single\", module_id: \"15\", channel: \"2\", name: \"å®¢å»³å¾Œ\" },\n    { type: \"single\", module_id: \"16\", channel: \"1\", name: \"èµ°é“é–“ç…§\" },\n    { type: \"single\", module_id: \"17\", channel: \"1\", name: \"å»šæˆ¿\" },\n    { type: \"single\", module_id: \"18\", channel: \"1\", name: \"1Fåœ°ç‡ˆ\" },\n    { type: \"single\", module_id: \"18\", channel: \"2\", name: \"1Få£ç‡ˆ\" },\n    { type: \"single\", module_id: \"19\", channel: \"1\", name: \"2Få£ç‡ˆ\" },\n    { type: \"single\", module_id: \"19\", channel: \"2\", name: \"2Fåœ°ç‡ˆ\" },\n    // WRGB\n    { type: \"wrgb\", module_id: \"2\", channel: \"x\", name: \"WRGBç‡ˆ-2\" },\n    { type: \"wrgb\", module_id: \"11\", channel: \"x\", name: \"WRGBç‡ˆ-11\" },\n    // RGB\n    { type: \"rgb\", module_id: \"11\", channel: \"x\", name: \"RGBç‡ˆ-11\" },\n];\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 330,
        "y": 80,
        "wires": [
            [
                "f6bf1604e7eae94d"
            ]
        ]
    },
    {
        "id": "928b6d4010212bf9",
        "type": "function",
        "z": "79859e535099be0e",
        "g": "3a585159d7619ee6",
        "name": "climates",
        "func": "// ç©ºèª¿è¨­å‚™æ¸…å–®ï¼ˆfunction nodeï¼Œå¯ç¨ç«‹ç®¡ç†ï¼‰\n// è¼¸å‡ºï¼šmsg.devices = [ ... ]\n\nmsg.devices = [\n    { type: \"hitachi\", module_id: \"200\", channel: \"1\", name: \"å®¢å»³ç©ºèª¿\" },\n    { type: \"hitachi\", module_id: \"200\", channel: \"2\", name: \"æœƒè­°å®¤ç©ºèª¿\" },\n    { type: \"hitachi\", module_id: \"200\", channel: \"3\", name: \"ç„é—œç©ºèª¿\" },\n    // { type: \"hitachi\", module_id: \"200\", channel: \"9\", name: \"è¾¦å…¬å®¤æ¸¬è©¦\" },\n];\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 320,
        "y": 160,
        "wires": [
            [
                "d8acce7dd404c11a"
            ]
        ]
    },
    {
        "id": "9b837e196b0b38cd",
        "type": "tcp request",
        "z": "79859e535099be0e",
        "g": "29d764fcfc0791af",
        "name": "",
        "server": "192.168.1.208",
        "port": "502",
        "out": "time",
        "ret": "buffer",
        "splitc": "0",
        "newline": "",
        "trim": false,
        "tls": "",
        "x": 2000,
        "y": 940,
        "wires": [
            [
                "573bdd7cc8dc6707"
            ]
        ]
    },
    {
        "id": "751ec40a6956d4f9",
        "type": "mqtt-broker",
        "name": "",
        "broker": "192.168.1.250",
        "port": "1883",
        "clientid": "",
        "autoConnect": true,
        "usetls": false,
        "protocolVersion": "4",
        "keepalive": "60",
        "cleansession": true,
        "autoUnsubscribe": true,
        "birthTopic": "",
        "birthQos": "0",
        "birthPayload": "",
        "birthMsg": {},
        "closeTopic": "",
        "closeQos": "0",
        "closePayload": "",
        "closeMsg": {},
        "willTopic": "",
        "willQos": "0",
        "willPayload": "",
        "willMsg": {},
        "userProps": "",
        "sessionExpiry": ""
    }
]